---
title: ç¬¬119æœŸ
date: '2022-02-25'
tags: ['èµ„è®¯', 'react', 'hooks']
draft: false
summary: React hooks çŠ¶æ€ç®¡ç†æ–¹æ¡ˆè§£æ;å¤§å¼€çœ¼ç•Œï¼šCSS æŒ‡çº¹
---

<TOCInline toc={props.toc} asDisclosure toHeading={3} />

## 2022/02/25

## æ¯å‘¨èµ„è®¯ - ç¬¬`119`æœŸ

### 1. React hooks çŠ¶æ€ç®¡ç†æ–¹æ¡ˆè§£æ

React v16.8 ä¹‹åï¼ŒFunction Component æˆä¸ºä¸»æµï¼ŒReact çŠ¶æ€ç®¡ç†çš„æ–¹æ¡ˆä¹Ÿå‘ç”Ÿå·¨å¤§çš„è½¬å˜ã€‚Redux ä¸€ç›´ä½œä¸ºä¸»æµçš„ React çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œè™½ç„¶æä¾›äº†ä¸€å¥—è§„èŒƒçš„çŠ¶æ€ç®¡ç†æµç¨‹ï¼Œä½†å´æœ‰ç€è®©äººé¥±å—è¯Ÿç—…çš„é—®é¢˜ï¼šæ¦‚å¿µå¤ªå¤šã€ä¸Šæ‰‹æˆæœ¬é«˜ã€é‡å¤çš„æ ·æ¿ä»£ç ã€éœ€è¦ç»“åˆä¸­é—´ä»¶ä½¿ç”¨ç­‰ã€‚

ä¸€ä¸ªçœŸæ­£æ˜“ç”¨çš„çŠ¶æ€ç®¡ç†å·¥å…·å¾€å¾€ä¸éœ€è¦è¿‡å¤šå¤æ‚çš„æ¦‚å¿µã€‚Hooks è¯ç”Ÿä¹‹åï¼Œä»£ç ä¼˜é›…ç®€æ´å˜æˆä¸€ç§è¶‹åŠ¿ã€‚å¼€å‘è€…ä¹Ÿå€¾å‘äºç”¨ä¸€ç§å°è€Œç¾ã€å­¦ä¹ æˆæœ¬ä½çš„æ–¹æ¡ˆæ¥å®ç°çŠ¶æ€ç®¡ç†ã€‚å› æ­¤ï¼Œé™¤äº† React local state hooks ä¹‹å¤–ï¼Œç¤¾åŒºè¿˜å­µåŒ–äº†å¾ˆå¤šçŠ¶æ€ç®¡ç†åº“ï¼Œå¦‚ unstated-nextã€hoxã€zustandã€jotai ç­‰ã€‚

å…³äºçŠ¶æ€ç®¡ç†ï¼Œæœ‰ä¸ªéå¸¸ç»å…¸çš„åœºæ™¯ï¼šå®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç‚¹å‡» + å·çš„æ—¶å€™å°†æ•°å­—åŠ ä¸€ï¼Œç‚¹å‡» - å·çš„æ—¶å€™å°†æ•°å€¼å‡ä¸€ã€‚è¿™å‡ ä¹æ˜¯æ‰€æœ‰çŠ¶æ€ç®¡ç†åº“æ ‡é…çš„å…¥é—¨æ¡ˆä¾‹ã€‚

æœ¬æ–‡å°†ä»å®ç°ã€Œè®¡æ•°å™¨ã€è¿™ä¸ªç»å…¸åœºæ™¯å‡ºå‘ï¼Œé€æ­¥åˆ†æ Hooks æ—¶ä»£ä¸‹ï¼ŒReact çŠ¶æ€ç®¡ç†æ–¹æ¡ˆçš„æ¼”è¿›è¿‡ç¨‹å’ŒèƒŒåçš„å®ç°åŸç†ã€‚

React local state hooks
React æä¾›äº†ä¸€äº›ç®¡ç†çŠ¶æ€çš„åŸç”Ÿ hooks APIï¼Œç®€æ´æ˜“æ‡‚ï¼Œéå¸¸å¥½ä¸Šæ‰‹ã€‚ç”¨åŸç”Ÿçš„ hooks æ–¹æ³•å°±å¯ä»¥å¾ˆè½»æ¾åœ°å®ç°è®¡æ•°å™¨åŠŸèƒ½ï¼Œåªè¦é€šè¿‡ useState æ–¹æ³•åœ¨æ ¹ç»„ä»¶å®šä¹‰è®¡æ•°å™¨çš„çŠ¶æ€å’Œæ”¹å˜çŠ¶æ€çš„æ–¹æ³•ï¼Œå¹¶å±‚å±‚ä¼ é€’ç»™å­ç»„ä»¶å°±å¯ä»¥äº†ã€‚

æºç 

```js
// timer.js
const Timer = (props) => {
  const { increment, count, decrement } = props
  return (
    <>
      <button onClick={decrement}>-</button>
      <span>{count}</span>
      <button onClick={increment}>+</button>
    </>
  )
}

// app.js
const App = () => {
  const [count, setCount] = React.useState(0)
  const increment = () => setCount(count + 1)
  const decrement = () => setCount(count - 1)

  return <Timer count={count} increment={increment} decrement={decrement} />
}
```

ä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨å¾ˆä¸¥é‡çš„ç¼ºé™·ã€‚

é¦–å…ˆï¼Œè®¡æ•°å™¨çš„ä¸šåŠ¡é€»è¾‘å’Œç»„ä»¶è€¦åˆä¸¥é‡ï¼Œéœ€è¦å°†é€»è¾‘è¿›è¡ŒæŠ½è±¡åˆ†ç¦»ï¼Œä¿æŒé€»è¾‘ä¸ç»„ä»¶çš„çº¯ç²¹æ€§ã€‚

å…¶æ¬¡ï¼Œå¤šç»„ä»¶å†…å…±äº«çŠ¶æ€æ˜¯é€šè¿‡å±‚å±‚ä¼ é€’çš„æ–¹å¼å®ç°çš„ï¼Œå¸¦æ¥å†—ä½™ä»£ç çš„åŒæ—¶ï¼Œæ ¹ç»„ä»¶çš„çŠ¶æ€å°†ä¼šé€æ¸å˜æˆ â€œåºç„¶å¤§ç‰©â€ã€‚

#### unstated-next

React å¼€å‘è€…åœ¨è®¾è®¡ä¹‹åˆï¼Œä¹Ÿè€ƒè™‘åˆ°ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œæœ¬èº«ä¹Ÿæä¾›äº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚

React Hooks å°±æ˜¯æ‰“ç€ã€Œé€»è¾‘å¤ç”¨ã€çš„å£å·è€Œè¯ç”Ÿçš„ï¼Œè‡ªå®šä¹‰ hook å¯ä»¥è§£å†³ä»¥å‰åœ¨ Class Component ç»„ä»¶å†…æ— æ³•çµæ´»å…±äº«é€»è¾‘çš„é—®é¢˜ã€‚

å› æ­¤ï¼Œé’ˆå¯¹ä¸šåŠ¡é€»è¾‘è€¦åˆçš„é—®é¢˜ï¼Œå¯ä»¥æå–ä¸€ä¸ªè‡ªå®šä¹‰è®¡æ•°å™¨ hook useCount ã€‚

```js
function useCount() {
  const [count, setCount] = React.useState(0)
  const increment = () => setCount(count + 1)
  const decrement = () => setCount(count - 1)
  return { count, increment, decrement }
}
```

ä¸ºäº†é¿å…ç»„ä»¶é—´å±‚å±‚ä¼ é€’çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ Context è§£å†³æ–¹æ¡ˆã€‚Context æä¾›äº†åœ¨ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€çš„æ–¹æ³•ï¼Œè€Œä¸å¿…åœ¨æ ‘çš„æ¯ä¸ªå±‚çº§æ˜¾å¼ä¼ é€’ä¸€ä¸ª prop ã€‚

å› æ­¤ï¼Œåªéœ€è¦å°†çŠ¶æ€å­˜å‚¨åœ¨ StoreContext ä¸­ï¼ŒProvider ä¸‹çš„ä»»æ„å­ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ useContext è·å–åˆ°ä¸Šä¸‹æ–‡ä¸­çš„çŠ¶æ€ã€‚

```js
// timer.js
import StoreContext from './StoreContext'

const Timer = () => {
  const store = React.useContext(StoreContext)
  // ç»„ä»¶å†… render éƒ¨åˆ†å…ˆçœç•¥
}

// app.js
const App = () => {
  const StoreContext = React.createContext()
  const store = useCount()

  return (
    <StoreContext.Provider value={store}>
      <Timer />
    </StoreContext.Provider>
  )
}
```

è¿™æ ·ä»£ç çœ‹èµ·æ¥æ¸…çˆ½äº†ä¸€äº›ã€‚

ä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™è¿˜æ˜¯å…ä¸äº†è¦å…ˆå®šä¹‰å¾ˆå¤š Contextï¼Œå¹¶ä¸”åœ¨å­ç»„ä»¶ä¸­è¿›è¡Œå¼•ç”¨ï¼Œç•¥å¾®æœ‰ç‚¹ç¹çã€‚

å› æ­¤ï¼Œå¯ä»¥å¯¹ä»£ç è¿›è¡Œè¿›ä¸€æ­¥çš„å°è£…ï¼Œå°† Context å®šä¹‰å’Œå¼•ç”¨çš„æ­¥éª¤æŠ½è±¡æˆå…¬å…±çš„æ–¹æ³• createContainerã€‚

![](https://p6.music.126.net/obj/wonDlsKUwrLClGjCm8Kx/13023834667/e5cb/a386/ab26/390ebf70a49b67128be912abc20d8128.png)

```js
function createContainer(useHook) {
  // å®šä¹‰ context
  const StoreContext = React.createContext()

  function useContainer() {
    // å­ç»„ä»¶å¼•ç”¨ context
    const store = React.useContext(StoreContext)
    return store
  }

  function Provider(props) {
    const store = useHook()

    return <StoreContext.Provider value={store}>{props.children}</StoreContext.Provider>
  }

  return { Provider, useContainer }
}
```

createContainer å°è£…åä¼šè¿”å›ä¸¤ä¸ªå¯¹è±¡ Provider å’Œ useContainerã€‚Provider ç»„ä»¶å¯ä»¥ä¼ é€’çŠ¶æ€ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶å¯ä»¥é€šè¿‡ useContainer æ–¹æ³•è·å–å…¨å±€çš„çŠ¶æ€ã€‚ç»è¿‡æ”¹é€ ï¼Œç»„ä»¶å†…çš„ä»£ç å°±ä¼šå˜å¾—éå¸¸ç²¾ç®€ã€‚

```jsx
const Store = createContainer(useCount)

// timer.js
const Timer = () => {
  const store = Store.useContainer()
  // ç»„ä»¶å†… render éƒ¨åˆ†å…ˆçœç•¥
}

// app.js
const App = () => {
  return (
    <Store.Provider>
      <Timer />
    </Store.Provider>
  )
}
```

è¿™æ ·ï¼Œä¸€ä¸ªåŸºæœ¬çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆæˆå‹äº†ï¼ä½“ç§¯å°ï¼ŒAPI ç®€å•ï¼Œå¯ä»¥è¯´æ˜¯ React çŠ¶æ€ç®¡ç†åº“çš„æœ€å°é›†ã€‚æºç å¯ä»¥è§è¿™é‡Œã€‚

è¿™ç§æ–¹æ¡ˆä¹Ÿæ˜¯çŠ¶æ€ç®¡ç†åº“ unstated-next çš„å®ç°åŸç†ã€‚

#### hox

å…ˆä¸è¦é«˜å…´å¾—å¤ªæ—©ã€‚unstated-next çš„æ–¹æ¡ˆè™½å¥½ï¼Œä½†ä¹Ÿæœ‰ç¼ºé™·çš„ï¼Œè¿™ä¹Ÿæ˜¯ React context å¹¿ä¸ºäººè¯Ÿç—…çš„ä¸¤ä¸ªé—®é¢˜ï¼š

- Context éœ€è¦åµŒå¥— Provider ç»„ä»¶ï¼Œä¸€æ—¦ä»£ç ä¸­ä½¿ç”¨å¤šä¸ª contextï¼Œå°†ä¼šé€ æˆåµŒå¥—åœ°ç‹±ï¼Œç»„ä»¶çš„å¯è¯»æ€§å’Œçº¯ç²¹æ€§ä¼šç›´çº¿é™ä½ï¼Œä»è€Œå¯¼è‡´ç»„ä»¶é‡ç”¨æ›´åŠ å›°éš¾ã€‚
- Context å¯èƒ½ä¼šé€ æˆä¸å¿…è¦çš„æ¸²æŸ“ã€‚ä¸€æ—¦ context é‡Œçš„ value å‘ç”Ÿæ”¹å˜ï¼Œä»»ä½•å¼•ç”¨ context çš„å­ç»„ä»¶éƒ½ä¼šè¢«æ›´æ–°ã€‚

é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è§£å†³ä¸Šé¢ä¸¤ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œç›®å‰å·²ç»æœ‰ä¸€äº›è‡ªå®šä¹‰çŠ¶æ€ç®¡ç†åº“è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜äº†ã€‚

ä» context çš„è§£å†³æ–¹æ¡ˆé‡Œï¼Œå…¶å®å¯ä»¥å¾—åˆ°ä¸€äº›å¯å‘ã€‚çŠ¶æ€ç®¡ç†çš„æµç¨‹å¯ä»¥ç®€åŒ–æˆä¸‰ä¸ªæ¨¡å‹ï¼šStoreï¼ˆå­˜å‚¨æ‰€æœ‰çŠ¶æ€ï¼‰ã€Hook ï¼ˆæŠ½è±¡å…¬å…±é€»è¾‘ï¼Œæ›´æ”¹çŠ¶æ€ï¼‰ã€Componentï¼ˆä½¿ç”¨çŠ¶æ€çš„ç»„ä»¶ï¼‰ã€‚

å¦‚æœè¦è‡ªå®šä¹‰çŠ¶æ€ç®¡ç†åº“ï¼Œåœ¨è„‘æµ·ä¸­å¯ä»¥å…ˆæ„æ€ä¸‹ï¼Œ è¿™ä¸‰è€…ä¹‹å‰çš„å…³ç³»åº”è¯¥æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ

![](https://p6.music.126.net/obj/wonDlsKUwrLClGjCm8Kx/13025055875/731a/c9f6/165e/1109e9e6858bdad5025bfb206584f0b7.png)

- è®¢é˜…æ›´æ–°ï¼šåˆå§‹åŒ–æ‰§è¡Œ Hook çš„æ—¶å€™ï¼Œéœ€è¦æ”¶é›†å“ªäº› Component ä½¿ç”¨äº† Store
- æ„ŸçŸ¥å˜æ›´ï¼šHook ä¸­çš„è¡Œä¸ºèƒ½å¤Ÿæ”¹å˜ Store çš„çŠ¶æ€ï¼Œä¹Ÿè¦èƒ½è¢« Store æ‰€æ„ŸçŸ¥åˆ°
- å‘å¸ƒæ›´æ–°ï¼šStore ä¸€æ—¦å˜æ›´ï¼Œéœ€è¦é©±åŠ¨æ‰€æœ‰è®¢é˜…æ›´æ–°çš„ Component æ›´æ–°

åªè¦å®Œæˆè¿™ä¸‰æ­¥ï¼ŒçŠ¶æ€ç®¡ç†åŸºæœ¬ä¸Šå°±å®Œæˆäº†ã€‚å¤§è‡´æ€è·¯æœ‰äº†ï¼Œä¸‹é¢å°±å¯ä»¥å…·ä½“å®ç°äº†ã€‚

##### çŠ¶æ€åˆå§‹åŒ–

é¦–å…ˆéœ€è¦åˆå§‹åŒ– Store çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ Hook æ–¹æ³•æ‰§è¡Œè¿”å›çš„ç»“æœã€‚åŒæ—¶å®šä¹‰ä¸€ä¸ª API æ–¹æ³•ï¼Œä¾›å­ç»„ä»¶è·å– Store çš„çŠ¶æ€ã€‚è¿™æ ·çŠ¶æ€ç®¡ç†åº“çš„æ¨¡å‹å°±æ­å‡ºæ¥äº†ã€‚

ä»ä¸šåŠ¡ä»£ç ä½¿ç”¨æ–¹æ³•ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒAPI ç®€æ´çš„åŒæ—¶ï¼Œä¹Ÿé¿å…äº† Provider ç»„ä»¶åµŒå¥—ã€‚

```js
// çŠ¶æ€ç®¡ç†åº“çš„æ¡†æ¶
function createContainer(hook) {
  const store = hook()
  // æä¾›ç»™å­ç»„ä»¶çš„ API æ–¹æ³•
  function useContainer() {
    const storeRef = useRef(store)
    return storeRef.current
  }
  return useContainer
}

// ä¸šåŠ¡ä»£ç ä½¿ç”¨ï¼šAPIç®€æ´
const useContainer = createContainer(useCount)

const Timer = () => {
  const store = useContainer()
  // ç»„ä»¶å†… render éƒ¨åˆ†å…ˆçœç•¥
}
```

##### è®¢é˜…æ›´æ–°

ä¸ºäº†å®ç° Store çŠ¶æ€æ›´æ–°çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé©±åŠ¨ç»„ä»¶æ›´æ–°ã€‚éœ€è¦å®šä¹‰ä¸€ä¸ª listeners é›†åˆï¼Œåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™å¾€æ•°ç»„æ·»åŠ  listener å›è°ƒï¼Œè®¢é˜…çŠ¶æ€çš„æ›´æ–°ã€‚

```js
function createContainer(hook) {
  const store = hook()

  const listeners = new Set() // å®šä¹‰å›è°ƒé›†åˆ

  function useContainer() {
    const storeRef = useRef(store)

    useEffect(() => {
      listeners.add(listener) // åˆå§‹åŒ–çš„æ—¶å€™æ·»åŠ å›è°ƒï¼Œè®¢é˜…æ›´æ–°

      return () => listeners.delete(listener) // ç»„ä»¶é”€æ¯çš„æ—¶å€™ç§»é™¤å›è°ƒ
    }, [])
    return storeRef.current
  }

  return useContainer
}
```

é‚£ä¹ˆå½“çŠ¶æ€æ›´æ–°åï¼Œå¦‚ä½•é©±åŠ¨ç»„ä»¶æ›´æ–°å‘¢ï¼Ÿè¿™é‡Œå¯ä»¥åˆ©ç”¨ useReducer hook å®šä¹‰ä¸€ä¸ªè‡ªå¢å‡½æ•°ï¼Œä½¿ç”¨ forceUpdate æ–¹æ³•å³å¯è®©ç»„ä»¶é‡åˆ·ã€‚

```js
const [, forceUpdate] = useReducer((c) => c + 1, 0)

function listener(newStore) {
  forceUpdate()
  storeRef.current = newStore
}
```

##### æ„ŸçŸ¥çŠ¶æ€å˜æ›´

çŠ¶æ€å˜æ›´é©±åŠ¨ç»„ä»¶æ›´æ–°çš„éƒ¨åˆ†å·²ç»å®Œæˆã€‚ç°åœ¨æ¯”è¾ƒé‡è¦çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•æ„ŸçŸ¥åˆ°çŠ¶æ€å‘ç”Ÿå˜æ›´äº†å‘¢ï¼Ÿ

çŠ¶æ€å˜æ›´æ˜¯åœ¨ useCount Hook å‡½æ•°å†…å®ç°çš„ï¼Œç”¨çš„æ˜¯ React åŸç”Ÿçš„ setState æ–¹æ³•ï¼Œä¹Ÿåªèƒ½åœ¨ React ç»„ä»¶å†…æ‰§è¡Œã€‚å› æ­¤ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ Executor å¼•ç”¨è¿™ä¸ª Hookï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªç»„ä»¶å†…å°±å¯ä»¥åˆå§‹åŒ–çŠ¶æ€ï¼Œå¹¶æ„ŸçŸ¥çŠ¶æ€å˜æ›´äº†ã€‚

è€ƒè™‘åˆ°çŠ¶æ€ç®¡ç†åº“çš„é€šç”¨æ€§ï¼Œå¯ä»¥é€šè¿‡ react-reconciler æ„é€ ä¸€ä¸ª react æ¸²æŸ“å™¨æ¥æŒ‚è½½ Executor ç»„ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥åˆ†åˆ«æ”¯æŒ Reactã€ReactNative ç­‰ä¸åŒæ¡†æ¶ã€‚

```jsx
// æ„é€  react æ¸²æŸ“å™¨
function render(reactElement: ReactElement) {
  const container = reconciler.createContainer(null, 0, false, null)
  return reconciler.updateContainer(reactElement, container)
}

// react ç»„ä»¶ï¼Œæ„ŸçŸ¥ hook å†…çŠ¶æ€çš„å˜æ›´
const Executor = (props) => {
  const store = props.hook()
  const mountRef = useRef(false)

  // çŠ¶æ€åˆå§‹åŒ–
  if (!mountRef.current) {
    props.onMount(store)
    mountRef.current = true
  }

  // store ä¸€æ—¦å˜æ›´ï¼Œå°±ä¼šæ‰§è¡Œ useEffect å›è°ƒ
  useEffect(() => {
    props.onUpdate(store) // ä¸€æ—¦çŠ¶æ€å˜æ›´ï¼Œé€šçŸ¥ä¾èµ–çš„ç»„ä»¶æ›´æ–°
  })

  return null
}
function createContainer(hook) {
  let store
  const onUpdate = () => {}

  // ä¼ é€’hookå’Œæ›´æ–°çš„å›è°ƒå‡½æ•°
  render(<Executor hook={hook} onMount={(val) => (store = val)} onUpdate={onUpdate} />)

  function useContainer() {}
  return useContainer
}
```

##### ç²¾ç¡®æ›´æ–°

ä¸€æ—¦æ„ŸçŸ¥åˆ°çŠ¶æ€å˜æ›´åï¼Œåœ¨ onUpdate å›è°ƒé‡Œå¯ä»¥é€šçŸ¥ä¹‹å‰è®¢é˜…è¿‡æ›´æ–°çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯éå† listeners é›†åˆï¼Œæ‰§è¡Œä¹‹å‰æ·»åŠ çš„æ›´æ–°å›è°ƒã€‚

```js
const onUpdate = (store) => {
  for (const listener of listeners) {
    listener(store)
  }
}
```

ä½†æ˜¯ï¼Œç»„ä»¶å¾€å¾€å¯èƒ½åªä¾èµ–äº† Store é‡Œçš„æŸä¸€ä¸ªçŠ¶æ€ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½æ›´æ–°çš„æ“ä½œå¤ªç²—æš´ï¼Œä¼šå¸¦æ¥ä¸å¿…è¦çš„æ›´æ–°ï¼Œéœ€è¦è¿›è¡Œç²¾ç¡®çš„æ›´æ–°æ¸²æŸ“ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨ç»„ä»¶çš„æ›´æ–°å›è°ƒé‡Œåˆ¤æ–­å½“å‰ä¾èµ–çš„çŠ¶æ€æ˜¯å¦å˜åŒ–ï¼Œä»è€Œå†³å®šæ˜¯å¦è§¦å‘æ›´æ–°ã€‚

```js
// useContainer API æ‰©å±•å¢åŠ ä¾èµ–å±æ€§
const store = useContainer('count') // ç»„ä»¶ä»…ä¾èµ–store.countå€¼

// æ›´æ–°å›è°ƒé‡Œåˆ¤æ–­
function listener(newStore) {
  const newValue = newStore[dep]
  const oldValue = storeRef.current[dep]

  // ä»…ä»…åœ¨ä¾èµ–å‘ç”Ÿå˜æ›´ï¼Œæ‰ä¼šç»„ä»¶è¿›è¡Œæ›´æ–°
  if (compare(newValue, oldValue)) {
    forceUpdate()
  }
  storeRef.current = newStore
}
```

å®Œæˆä»¥ä¸Šçš„æ­¥éª¤ï¼Œä¸€ä¸ªç®€å•åˆå¥½ç”¨çš„çŠ¶æ€ç®¡ç†åº“å°±å®ç°å•¦ï¼æºç å¯ä»¥çœ‹è¿™é‡Œã€‚çŠ¶æ€æ›´æ–°çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://p6.music.126.net/obj/wonDlsKUwrLClGjCm8Kx/13024860122/394b/a30e/9254/49cf9d34e35d4225b5922425f40dcc3b.png)

API ç®€æ´ï¼Œé€»è¾‘å’Œ UI åˆ†ç¦»ï¼Œèƒ½è·¨ç»„ä»¶ä¼ è¾“çŠ¶æ€ï¼Œæ²¡æœ‰å†—ä½™çš„åµŒå¥—ç»„ä»¶ï¼Œå¹¶ä¸”èƒ½å®ç°ç²¾ç¡®æ›´æ–°ã€‚

è¿™ä¹Ÿæ˜¯çŠ¶æ€ç®¡ç†åº“ hox èƒŒåçš„å®ç°åŸç†ã€‚

#### zustand

å…³äºå¦‚ä½•æ„ŸçŸ¥çŠ¶æ€å˜æ›´è¿™ä¸€èŠ‚ä¸­ï¼Œå› ä¸º useCount å‡½æ•°ä¸­æ˜¯é€šè¿‡æ“ä½œ react åŸç”Ÿ hook æ–¹æ³•å®ç°çŠ¶æ€å˜æ›´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ Executor ä½œä¸ºä¸­é—´æ¡¥æ¢æ¥æ„ŸçŸ¥çŠ¶æ€å˜æ›´ã€‚

ä½†æ˜¯ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§å§”å±ˆæ±‚å…¨çš„æ–¹æ¡ˆï¼Œä¸å¾—å·²å°†æ–¹æ¡ˆå¤æ‚åŒ–äº†ã€‚è¯•æƒ³ä¸‹ï¼Œå¦‚æœå˜æ›´çŠ¶æ€çš„æ–¹æ³• setState æ˜¯ç”±çŠ¶æ€ç®¡ç†åº“è‡ªèº«æä¾›çš„ï¼Œé‚£ä¹ˆä¸€æ—¦æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå°±å¯ä»¥æ„ŸçŸ¥çŠ¶æ€å˜æ›´ï¼Œå¹¶è§¦å‘åç»­çš„æ¯”è¾ƒæ›´æ–°æ“ä½œï¼Œæ•´ä½“æµç¨‹ä¼šç®€å•å¾ˆå¤šï¼

![](https://p5.music.126.net/obj/wonDlsKUwrLClGjCm8Kx/13024762837/fa19/d11d/ae4b/624cbe55bd61a74b22167cb0a5a25127.png)

```js
// å°†æ”¹å˜çŠ¶æ€çš„ setState æ–¹æ³•ä¼ é€’ç»™ hook
// hookå†…ä¸€æ—¦æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå³å¯æ„ŸçŸ¥çŠ¶æ€å˜æ›´ï¼Œæ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€
function useCount(setState) {
  const increment = () => setState((state) => ({ ...state, count: state.count + 1 }))
  const decrement = () => setState((state) => ({ ...state, count: state.count - 1 }))
  return { count: 0, increment, decrement }
}
```

```js
function createContainer(hook) {
  let store

  const setState = (partial) => {
    const nexStore = partial(store)
    // hookä¸­ä¸€æ—¦æ‰§è¡Œ setState çš„æ“ä½œï¼Œä¸”çŠ¶æ€å˜æ›´åï¼Œå°†è§¦å‘ onUpdate æ›´æ–°
    if (nexStore !== store) {
      store = Object.assign({}, store, nexStore)
      onUpdate(store)
    }
  }
  // å°†æ”¹å˜çŠ¶æ€çš„æ–¹æ³• setState ä¼ é€’ç»™hookå‡½æ•°
  store = hook(setState)
}

const useContainer = createContainer(useCount)
```

è¿™ç§æ–¹æ¡ˆæ›´åŠ é«˜æ˜ï¼Œè®©çŠ¶æ€ç®¡ç†åº“çš„å®ç°æ›´åŠ ç®€æ´æ˜äº†ï¼Œåº“çš„ä½“ç§¯ä¹Ÿä¼šå°ä¸å°‘ã€‚æºç å¯è§è¿™é‡Œã€‚

è¿™ç§æ–¹æ¡ˆæ˜¯ zustand èƒŒåçš„å¤§è‡´åŸç†ã€‚è™½ç„¶éœ€è¦å¼€å‘è€…å…ˆç†Ÿæ‚‰ä¸‹å¯¹åº”çš„å†™æ³•ï¼Œä½†æ˜¯ API ä¸ Hooks ç±»ä¼¼ï¼Œå­¦ä¹ æˆæœ¬å¾ˆä½ï¼Œä¸Šæ‰‹å®¹æ˜“ã€‚

#### æ€»ç»“

æœ¬æ–‡ä»å®ç°ä¸€ä¸ªè®¡æ•°å™¨åœºæ™¯å‡ºå‘ï¼Œé˜è¿°äº†å¤šç§çŠ¶æ€ç®¡ç†çš„æ–¹æ¡ˆå’Œå…·ä½“å®ç°ã€‚ä¸åŒçŠ¶æ€ç®¡ç†æ–¹æ¡ˆäº§ç”Ÿéƒ½æœ‰ç€å„è‡ªçš„èƒŒæ™¯ï¼Œä¹Ÿæœ‰ç€å„è‡ªçš„ä¼˜åŠ£ã€‚

ä½†æ˜¯è‡ªå®šä¹‰çŠ¶æ€ç®¡ç†åº“çš„è®¾è®¡æ€æƒ³éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚ç›®å‰å¼€æºç¤¾åŒºæ¯”è¾ƒæ´»è·ƒçš„çŠ¶æ€ç®¡ç†åº“å¤§å¤šæ˜¯å¦‚æ­¤ï¼Œä¸åŒç‚¹ä¸»è¦æ˜¯åœ¨å¦‚ä½•æ„ŸçŸ¥çŠ¶æ€å˜æ›´è¿™å—åšäº›æ–‡ç« ã€‚

çœ‹å®Œæœ¬æ–‡ï¼Œæƒ³å¿…ä½ å·²ç»çŸ¥é“å¦‚ä½•è¿›è¡Œ React Hooks ä¸‹çš„çŠ¶æ€ç®¡ç†äº†ï¼Œé‚£å°±èµ¶ç´§è¡ŒåŠ¨å§ï¼

#### æ¥æº

- [React hooks çŠ¶æ€ç®¡ç†æ–¹æ¡ˆè§£æ](https://mp.weixin.qq.com/s/MmBFwrAUhRzROLllWUa0gg)

### 2. å¤§å¼€çœ¼ç•Œï¼šCSS æŒ‡çº¹

#### ä»€ä¹ˆæ˜¯ CSS æŒ‡çº¹ï¼Ÿ

CSS æŒ‡çº¹æ˜¯ä¸€ç§è·Ÿè¸ªå’Œæ”¶é›†ç”¨æˆ·ä¿¡æ¯çš„æŠ€æœ¯ï¼Œè¿™ç§æ–¹æ³•ä¸»è¦æ˜¯åˆ©ç”¨äº† CSS çš„ä¸€äº›ç‰¹æ€§æ¥è·Ÿè¸ªç”¨æˆ·çš„æµè§ˆå™¨å’Œè®¾å¤‡çš„å„ç§ç‰¹å¾ï¼Œè¿™äº›ç‰¹å¾ä»¥åå¯ä»¥ç”¨æ¥è¯†åˆ«æˆ–è·Ÿè¸ªç”¨æˆ·

#### CSS æŒ‡çº¹å¦‚ä½•ç”Ÿæˆ

åŸç†æ¯”è¾ƒç®€å•ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡æ— æ•°çš„åª’ä½“æŸ¥è¯¢æ¥ç»™é¡µé¢è¿”å›ä¸€å¥—é€‚ç”¨çš„ CSS æ ·å¼ä»£ç ï¼Œè¿™å¥— CSS ä»£ç ä¸­ä¼šæœ‰å¾ˆå¤šçš„èƒŒæ™¯å›¾ç‰‡ï¼ŒèƒŒæ™¯å›¾ç‰‡çš„åœ°å€æ˜¯ä¸€ä¸ªç‰¹å®šçš„ URLï¼Œè¿™ä¸ª URL ä¸Šæºå¸¦äº†ä¸€äº›æˆ‘ä»¬éœ€è¦æ”¶é›†çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼š

```scss
@media screen and (width: 300px) {
  body {
    background: url(https://zero2one/collect/info/width=300);
  }
}
```

è¿™ä¸ªåª’ä½“æŸ¥è¯¢ä»£ç åªä¼šåœ¨ç”¨æˆ·è®¾å¤‡å®½åº¦ä¸º 300px æ—¶ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ŠæŠ¥çš„åœ°å€ä¹Ÿå¯ä»¥å¸¦ä¸Š width=300 çš„ä¿¡æ¯ï¼Œå…¶å®ƒä¿¡æ¯ä¹Ÿç±»ä¼¼è¿™ç§æ–¹æ¡ˆå»å®ç°ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†

ä¸ºäº†é¿å…ä¿¡æ¯çš„é‡å¤ä¸ŠæŠ¥ï¼ŒæœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°è¯¥ä¿¡æ¯ä¸ŠæŠ¥åï¼Œæœ€å¥½å°† HTTP çš„çŠ¶æ€ç è¿”å› 410ï¼ˆGoneï¼‰ï¼Œè¿™æ ·è¯¥è¯·æ±‚å°±ä¼šç¼“å­˜ä¸‹æ¥ï¼Œä¹‹åé‡å¤çš„è¯·æ±‚éƒ½ä¸ä¼šèµ°åˆ°æœåŠ¡ç«¯ï¼Œè€Œæ˜¯èµ°çš„ç¼“å­˜ã€‚æœ€ç»ˆçš„æ•ˆæœå°±ç±»ä¼¼è¿™æ ·ï¼š

![](https://ucc.alicdn.com/pic/developer-ecology/4438866c14d84c539097b061e9867fbc.png)

åŒæ ·çš„ï¼Œç”¨æˆ·æœ¬åœ°å®‰è£…äº†å“ªäº›å­—ä½“ä¹Ÿå¯ä»¥è¿½è¸ªåˆ°ï¼Œä¸è¿‡å®ç°èµ·æ¥æœ‰äº›éº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ—ä¸¾å‡ ç™¾ç”šè‡³å‡ åƒç§å­—ä½“æ ·å¼ä»£ç ï¼Œè®©é¡µé¢å»æœ¬åœ°åŠ è½½å¯¹åº”å­—ä½“ï¼Œè‹¥æœ¬åœ°æ²¡æœ‰è¯¥å­—ä½“åˆ™å‘èµ·ç½‘ç»œè¯·æ±‚åˆ°æˆ‘ä»¬çš„æœåŠ¡ç«¯ï¼Œæœ€åå¯¹æ¯”ä¸€ä¸‹å“ªå‡ ä¸ªå­—ä½“æ²¡ä¸ŠæŠ¥ï¼Œå°±è¯´æ˜ç”¨æˆ·æœ¬åœ°æœ‰å“ªäº›å­—ä½“äº†~

ä¸¾ä¸ªä¾‹å­ ğŸŒ°ï¼š

```css
@font-face {
  font-family: abeezee;
  font-display: block;
  src: local(Abeezee), /* åŠ è½½æœ¬åœ°å­—ä½“ Abeezee */ url(/collect/info/font-name=Abeezee); /* è‹¥åŠ è½½å¤±è´¥ï¼Œåˆ™ä¸ŠæŠ¥ä¿¡æ¯ font-name=Abeezee */
}
@font-face {
  font-family: abel;
  font-display: block;
  src: local(Abel), /* åŠ è½½æœ¬åœ°å­—ä½“ Abel */ url(/some/url/font-name=Abel); /* è‹¥åŠ è½½å¤±è´¥ï¼Œåˆ™ä¸ŠæŠ¥ä¿¡æ¯ font-name=Abel */
}
/* ...æ­¤å¤„çœç•¥æˆç™¾ä¸Šåƒä¸ªç±»ä¼¼å­—ä½“æ ·å¼ä»£ç  */
```

è‹¥æœ€åæˆ‘ä»¬æœåŠ¡ç«¯æ‰€æœ‰å­—ä½“çš„ä¿¡æ¯ä¸ŠæŠ¥éƒ½æ”¶åˆ°äº†ï¼Œå”¯ç‹¬æ²¡æœ‰æ”¶åˆ° `/collect/info/font-name=Abeezee` è¿™æ¡è¯·æ±‚ï¼Œè¯´æ˜è¯¥ç”¨æˆ·æœ¬åœ°åªå®‰è£…äº† Abeezee è¿™ä¸ªå­—ä½“

å†å¤šä¸¾å‡ ä¸ªä¾‹å­ ğŸŒ°ï¼Œåˆ¤æ–­ç”¨æˆ·å½“å‰æ˜¯å“ªä¸ªæµè§ˆå™¨ï¼š

```scss
@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  body {
    background: url(https://zero2one/collect/info/browser=IE10+);
  }
}

@media all and (min-width: 0) {
  body {
    background: url(https://zero2one/collect/info/browser=IE9+);
  }
}

@-moz-document url-prefix() {
  body {
    background: url(https://zero2one/collect/info/browser=firefox);
  }
}

@media screen and (-webkit-min-device-pixel-ratio: 0) {
  body {
    background: url(https://zero2one/collect/info/browser=chrome);
  }
}
```

##### æ›´å¤šçš„ç”¨æˆ·ä¿¡æ¯å¯ä»¥è§åª’ä½“æŸ¥è¯¢æ”¯æŒçš„åŠŸèƒ½

![](https://ucc.alicdn.com/pic/developer-ecology/b30553a6352743d5b908f021f5560634.png)

#### ä¸ºä½•è¦æœ‰ CSS æŒ‡çº¹

å› ä¸ºå¤§å¤šæ•°çš„ç”¨æˆ·éšç§è¿½è¸ªéƒ½æ˜¯ä¾èµ–äº JavaScript ã€Cookies çš„ï¼Œå°¤å…¶æ˜¯ Cookiesï¼Œä½ åœ¨å¤§å¤šæ•°çš„ç½‘ç«™éƒ½èƒ½è§åˆ°ä¸€ä¸ªå¼¹çª—å‘ä½ è¯·æ±‚ Cookies çš„è®¿é—®æƒé™ï¼Œä¾‹å¦‚ stack overflow ç½‘ç«™ä¸€è¿›å»å°±ä¼šå‡ºå¼¹æ¡†ï¼š

![](https://ucc.alicdn.com/pic/developer-ecology/f15f794604a64b1e9348de2fc80272cd.png)

ä½†æ— è®ºæ˜¯ JavaScript è¿˜æ˜¯ Cookiesï¼Œéƒ½å¾ˆå®¹æ˜“åè¿½è¸ªï¼Œæ¯”å¦‚ç¦ç”¨é¡µé¢çš„ JS è„šæœ¬ã€è¿æ¥ VPN æˆ–è€…æ˜¯ä½¿ç”¨äº†æŸäº›åè¿½è¸ªçš„æµè§ˆå™¨æ’ä»¶ç­‰ç­‰ï¼Œè€Œ CSS æŒ‡çº¹å°±å¯ä»¥ä¸å—è¿™äº›çš„é™åˆ¶è€Œæ”¶é›†åˆ°ç”¨æˆ·ç›¸å…³æ•°æ®

#### CSS æŒ‡çº¹ç¼ºç‚¹

ä¸Šè¿°æ‰€è¯´çš„æ–¹æ¡ˆæœ‰ä¸€ä¸ªæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼šCSS æ–‡ä»¶ä¼šç‰¹åˆ«å¤§ï¼Œå¦‚æœå¸¦ä¸Šæ‰€æœ‰å­—ä½“çš„è¯·æ±‚ï¼Œç”šè‡³æµè§ˆå™¨å¹¶å‘çš„è¯·æ±‚éƒ½ä¼šè¾¾åˆ°æ•°ç™¾ä¸ªï¼Œè¿™ä¸€å®šæ˜¯ä¼šå½±å“ç”¨æˆ·ä½“éªŒçš„

##### ä¼˜åŒ–è¯·æ±‚æ¬¡æ•°

è¦çŸ¥é“ç”¨æˆ·æœ¬åœ°æœ‰å“ªäº›å­—ä½“çš„ä»£ä»·æ¯”è¾ƒé«˜ï¼Œæˆ–è®¸å¯ä»¥é€šè¿‡æœ¬åœ°æœ‰å“ªäº›å­—ä½“æ¥åˆ¤æ–­ç”¨æˆ·å½“å‰çš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºå¸‚é¢ä¸Šå¤§éƒ¨åˆ†çš„æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„é‚£äº›é»˜è®¤æœ¬åœ°å­—ä½“å°±åªæœ‰é‚£äº›ï¼Œç›´æ¥å»è¯·æ±‚è¿™äº›å­—ä½“å°±è¶³å¤Ÿäº†~

æˆ‘ä»¬ç°åœ¨æ¯æ”¶é›†ä¸€æ¡ä¿¡æ¯éƒ½è¦ä¸ŠæŠ¥ä¸€æ¬¡ï¼Œå¦‚æœä¸ç®—å­—ä½“è¯·æ±‚ä¸ŠæŠ¥ï¼Œä¼°è®¡å¹¶å‘çš„ä¸ŠæŠ¥è¯·æ±‚ä¹Ÿæœ‰å‡ åæ¡äº†ï¼Œæœ‰ä¸€ç§æ€è·¯å°±æ˜¯è¯·æ±‚åˆå¹¶ï¼Œçœ‹çœ‹èƒ½å¦æŠŠæ‰€æœ‰è¦æ”¶é›†çš„å‚æ•°æ‹¼æ¥åˆ°ä¸€ä¸ª URL ä¸Šå»ï¼Œä½†ç›®å‰ä¸ºæ­¢ä»…åœ¨ CSS é‡Œå¥½åƒæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º url() æ˜¯ä¸èƒ½ä½¿ç”¨è‡ªå®šä¹‰ CSS å˜é‡çš„ï¼Œæ¥çœ‹ä¸ªä¾‹å­ï¼š

```css
::root {
  --request-url: 'https://zero2one/collect/info/width=300';
}

body {
  background: url(var(--request-url)); /* error */
}
```

è¿™æ ·ç”¨æ˜¯ä¸è¡Œçš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¤§å®¶éƒ½çŸ¥é“ url() é‡Œçš„å†…å®¹æ—¢å¯ä»¥åŠ å¼•å·ï¼Œä¹Ÿå¯ä»¥ä¸åŠ ï¼š

```css
body {
  background: url(https://zero2one/collect/info/width=300); /* right */
}

.root {
  background: url('https://zero2one/collect/info/width=300'); /* right */
}
```

è¿™æ˜¯å†å²é—ç•™é—®é¢˜å¯¼è‡´çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³åœ¨ url() é‡Œä½¿ç”¨è‡ªå®šä¹‰å˜é‡å°±ä¼šæŠ¥é”™ï¼ŒCSS åœ¨è§£ææ—¶ä¼šæŠŠ url() ä¸­çš„æ‰€æœ‰å†…å®¹å½“åš URLï¼Œè€Œç°åœ¨å€¼ä¸­æœ‰éè½¬ä¹‰ ( ä¼šå¯¼è‡´ä¸€ä¸ªåˆ†æçš„é”™è¯¯ï¼Œæ‰€ä»¥æ•´ä¸ªå£°æ˜è¢«ä½œä¸ºæ— æ•ˆæŠ›å‡ºï¼Œé‚£ä¹ˆæƒ³ç”¨è‡ªå®šä¹‰å˜é‡è¯¥æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ

```css
::root {
  --request-url: url('https://zero2one/collect/info/width=300');
}

body {
  background: var(--request-url); /* right */
}
```

è¿™æ ·å°±æ²¡æœ‰é—®é¢˜äº†ï¼

å¥½äº†è¨€å½’æ­£ä¼ ï¼Œæ­£æ˜¯å› ä¸ºè¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¼¼ä¹æ²¡æ³•å¯¹ç”¨æˆ·æ•°æ®åšä¸€ä¸ªæ‹¼æ¥åˆå¹¶ä¸ŠæŠ¥ï¼Œæ‰€ä»¥ CSS Values and Units Module Level 4 æå‡ºäº†è¿™æ ·ä¸€ä¸ªè‰æ¡ˆ

> å¦‚æœçœ‹ä¸æ‡‚è¿™ä¸ªè¯­æ³•è§£é‡Šçš„åŒå­¦å¯ä»¥å»çœ‹æˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡ CSS è¯­æ³•è‡ªå­¦æŒ‡å—ï¼šçƒ­è®®ï¼š[CSS ä¸ºä»€ä¹ˆè¿™ä¹ˆéš¾å­¦ï¼Ÿä¸€å®šæ˜¯ä½ çš„æ–¹æ³•ä¸å¯¹](https://mp.weixin.qq.com/s?__biz=MzkxMjI3MTA1Mg==&mid=2247505833&idx=1&sn=30e29599de118e92f2b2d10988a3f373&scene=21#wechat_redirect)

ç®€å•æ¥è¯´çš„è¯ï¼Œå°±æ˜¯ url() é‡Œé¢å¯ä»¥å¡«å…¥å­—ç¬¦ä¸² + 0 æˆ–å¤šä¸ªä¿®é¥°ç¬¦ï¼Œå»çœ‹äº†ä¸€ä¸‹ä¿®é¥°ç¬¦çš„å«ä¹‰ï¼Œä¼¼ä¹ä¿®é¥°ç¬¦å¯ä»¥å†™ CSS å‡½æ•°ï¼ˆç±»ä¼¼ calc()ã€var()ã€attr() ...ï¼‰ï¼Œè¿™æ ·ä¸å°±æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†å—ï¼Ÿæ¥æ¨¡æ‹Ÿå†™ä¸€ä¸‹ï¼š

```css
::root {
  --screen-width: 'width=300';
  --screen-height: '&height=500';
}

body {
  background: url('https://zero2one/collect/info?'var(--screen-width)var(--screen-height));
}
```

è¿™æ ·å°±æ¨¡æ‹Ÿäº†æˆ‘ä»¬ JS ä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥~ å²‚ä¸æ˜¯ç¾å“‰ï¼Œç„¶åå†åŠ ä¸Šå…¶å®ƒåª’ä½“æŸ¥è¯¢çš„å˜é‡ä¿®æ”¹ï¼Œå°±å®ç°äº†ä¸€æ¬¡è¯·æ±‚ä¸ŠæŠ¥æ‰€æœ‰ä¿¡æ¯çš„éœ€æ±‚

```css
::root {
  --screen-width: '';
  --screen-height: '';
}

@media screen and (width: 300px) {
  ::root {
    --screen-width: 'width=300';
  }
}

@media screen and (height: 500px) {
  ::root {
    --screen-height: '&height=500';
  }
}

body {
  background: url('https://zero2one/collect/info?'var(--screen-width)var(--screen-height));
}
```

å¸Œæœ›è¿™ä¸ªè‰æ¡ˆèƒ½é¡ºåˆ©é€šè¿‡~ è¿™æ · CSS æŒ‡çº¹çš„æ–¹æ¡ˆå°±åˆæ›´åŠ å®Œå–„äº†ï¼

#### æ¥æº

- [å¤§å¼€çœ¼ç•Œï¼šCSS æŒ‡çº¹](https://mp.weixin.qq.com/s/gFCGM7ANOxHqYxGItyA_CA)

## 30 seconds of code

### ç›®æ ‡

Memoize a function

### æ ·ä¾‹è¾“å‡º:

```js
// Calculate Fibonacci numbers
const fibo = memoize((n) => (n <= 2 ? 1 : fibo(n - 1) + fibo(n - 2)))

fibo(1) // 1
fibo(2) // 1
fibo(3) // 2
```

### å‚è€ƒå®ç°

```js
const memoize = (fn) =>
  (
    (cache = Object.create(null)) =>
    (arg) =>
      cache[arg] || (cache[arg] = fn(arg))
  )()
```

## ts æŒ‘æˆ˜

### è·å–å…ƒç»„é•¿åº¦

åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ Lengthï¼Œæ¥å—ä¸€ä¸ª readonly çš„æ•°ç»„ï¼Œè¿”å›è¿™ä¸ªæ•°ç»„çš„é•¿åº¦

```ts
type tesla = ['tesla', 'model 3', 'model X', 'model Y']
type spaceX = ['FALCON 9', 'FALCON HEAVY', 'DRAGON', 'STARSHIP', 'HUMAN SPACEFLIGHT']

type teslaLength = Length<tesla> // expected 4
type spaceXLength = Length<spaceX> // expected 5
```

## å¥½åº“æ¨è

- [react-query-helper](https://github.com/dano-inc/react-query-helper) â€” React Query å¾ˆå¥½ï¼Œä½†å°†å˜å¾—æ›´ç®€å•ä»¥åŠæ›´è½»æ¾ã€‚
- [use-cannon v4.5](https://github.com/pmndrs/use-cannon)ï¼šç”± react-three-fiber æä¾›çš„åŠ¨ç”» Hook
