---
title: ç¬¬137æœŸ
date: '2022-06-12'
tags: ['èµ„è®¯', 'css', 'æ€§èƒ½', 'node']
draft: false
summary: ä½¿ç”¨ content-visibility ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½;æµ…æ path å¸¸ç”¨å·¥å…·å‡½æ•°æºç ;æµ…æ path å¸¸ç”¨å·¥å…·å‡½æ•°æºç 
---

<TOCInline toc={props.toc} asDisclosure toHeading={3} />

## 2022/06/12

## æ¯å‘¨èµ„è®¯ - ç¬¬`137`æœŸ

### 1. ä½¿ç”¨ content-visibility ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½

æœ€è¿‘åœ¨ä¸šåŠ¡ä¸­å®é™…ä½¿ç”¨ content-visibility è¿›äº†ä¸€äº›æ¸²æŸ“æ€§èƒ½çš„ä¼˜åŒ–ã€‚

è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°ä¸”æœ‰å¼ºå¤§åŠŸèƒ½çš„å±æ€§ã€‚æœ¬æ–‡å°†å¸¦é¢†å¤§å®¶æ·±å…¥ç†è§£ä¸€ç•ªã€‚

#### ä½•ä¸º content-visibilityï¼Ÿ

content-visibilityï¼šå±æ€§æ§åˆ¶ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ¸²æŸ“å…¶å†…å®¹ï¼Œå®ƒå…è®¸ç”¨æˆ·ä»£ç†ï¼ˆæµè§ˆå™¨ï¼‰æ½œåœ¨åœ°çœç•¥å¤§é‡å¸ƒå±€å’Œæ¸²æŸ“å·¥ä½œï¼Œç›´åˆ°éœ€è¦å®ƒä¸ºæ­¢ã€‚

> MDN åŸæ–‡ï¼šThe content-visibility CSS property controls whether or not an element renders its contents at all, along with forcing a strong set of containments, allowing user agents to potentially omit large swathes of layout and rendering work until it becomes needed. Basically it enables the user agent to skip an element's rendering work (including layout and painting) until it is needed â€” which makes the initial page load much faster.

```css
/* Keyword values */
content-visibility: visible;
content-visibility: hidden;
content-visibility: auto;
```

åˆ†åˆ«è§£é‡Šä¸€ä¸‹ï¼š

- content-visibility: visibleï¼šé»˜è®¤å€¼ï¼Œæ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œç›¸å½“äºæ²¡æœ‰æ·»åŠ  content-visibilityï¼Œå…ƒç´ çš„æ¸²æŸ“ä¸å¾€å¸¸ä¸€è‡´ã€‚
- content-visibility: hiddenï¼šä¸ display: none ç±»ä¼¼ï¼Œç”¨æˆ·ä»£ç†å°†è·³è¿‡å…¶å†…å®¹çš„æ¸²æŸ“ã€‚ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè·³è¿‡çš„æ˜¯å†…å®¹çš„æ¸²æŸ“ï¼‰
- content-visibility: autoï¼šå¦‚æœè¯¥å…ƒç´ ä¸åœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”ä¸ç”¨æˆ·æ— å…³ï¼Œåˆ™ä¸ä¼šæ¸²æŸ“å…¶åä»£å…ƒç´ ã€‚

#### contain-intrinsic-size

å½“ç„¶ï¼Œé™¤ content-visibility ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸ä¹‹é…å¥—çš„å±æ€§ -- contain-intrinsic-sizeã€‚

contain-intrinsic-sizeï¼šæ§åˆ¶ç”± content-visibility æŒ‡å®šçš„å…ƒç´ çš„è‡ªç„¶å¤§å°ã€‚

ä¸Šé¢ä¸¤ä¸ªå±æ€§å…‰çœ‹å®šä¹‰å’Œä»‹ç»ä¼šæœ‰ç‚¹ç»•ã€‚

æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹ content-visibility å¦‚ä½•å…·ä½“ä½¿ç”¨ã€‚

content-visibility: visible æ˜¯é»˜è®¤å€¼ï¼Œæ·»åŠ åæ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œæˆ‘ä»¬å°±ç›´æ¥è·³è¿‡ã€‚

#### åˆ©ç”¨ content-visibility: hidden ä¼˜åŒ–å±•ç¤ºåˆ‡æ¢æ€§èƒ½

é¦–å…ˆæ¥çœ‹çœ‹ content-visibility: hiddenï¼Œå®ƒé€šå¸¸ä¼šæ‹¿æ¥å’Œ display: none åšæ¯”è¾ƒï¼Œä½†æ˜¯å…¶å®å®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¸åŒçš„ã€‚

é¦–å…ˆï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ª DIV åŒ…è£¹æ¡†ï¼š

```html
<div class="g-wrap">
  <div>1111</div>
  <div class="hidden">2222</div>
</div>
```

è®¾ç½®ä¸¤ä¸ª div ä¸º 200x200 çš„é»‘è‰²å—ï¼š

```css
.g-wrap > div {
  width: 200px;
  height: 200px;
  background: #000;
}
```

æ•ˆæœå¦‚ä¸‹ï¼š

![](https://pic4.zhimg.com/80/v2-3d6995d301919bb69d1751266b02b46b_720w.webp)

OKï¼Œæ²¡æœ‰é—®é¢˜ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»™å…¶ä¸­çš„ .hidden è®¾ç½® content-visibility: hiddenï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

```less
.hidden {
  content-visibility: hidden;
}
```

æ•ˆæœå¦‚ä¸‹ï¼š

![](https://pic4.zhimg.com/80/v2-9c8e604a946b6e519b1a101078d00cd7_720w.webp)

æ³¨æ„ï¼Œä»”ç»†çœ‹æ•ˆæœï¼Œè¿™é‡Œæ·»åŠ äº† content-visibility: hidden ä¹‹åï¼Œæ¶ˆå¤±çš„åªæ˜¯æ·»åŠ äº†è¯¥å…ƒç´ çš„ div çš„å­å…ƒç´ æ¶ˆå¤±ä¸è§ï¼Œè€Œçˆ¶å…ƒç´ æœ¬èº«åŠå…¶æ ·å¼ï¼Œè¿˜æ˜¯å­˜åœ¨é¡µé¢ä¸Šçš„ã€‚

å¦‚æœæˆ‘ä»¬å»æ‰è®¾ç½®äº† content-visibility: hidden çš„å…ƒç´ æœ¬èº«çš„ widthã€heightã€paddingã€margin ç­‰å±æ€§ï¼Œåˆ™å…ƒç´ çœ‹ä¸Šå»å°±å¦‚åŒè®¾ç½®äº† display: none ä¸€èˆ¬ï¼Œåœ¨é¡µé¢ä¸Šæ¶ˆå¤±ä¸è§äº†ã€‚

é‚£ä¹ˆï¼Œcontent-visibility: hidden çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

è®¾ç½®äº† content-visibility: hidden çš„å…ƒç´ ï¼Œå…¶å…ƒç´ çš„å­å…ƒç´ å°†è¢«éšè—ï¼Œä½†æ˜¯ï¼Œå®ƒçš„æ¸²æŸ“çŠ¶æ€å°†ä¼šè¢«ç¼“å­˜ã€‚æ‰€ä»¥ï¼Œå½“ content-visibility: hidden è¢«ç§»é™¤æ—¶ï¼Œç”¨æˆ·ä»£ç†æ— éœ€é‡å¤´å¼€å§‹æ¸²æŸ“å®ƒå’Œå®ƒçš„å­å…ƒç´ ã€‚

å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªå±æ€§åº”ç”¨åœ¨ä¸€äº›ä¸€å¼€å§‹éœ€è¦è¢«éšè—ï¼Œä½†æ˜¯å…¶ååœ¨é¡µé¢çš„æŸä¸€æ—¶åˆ»éœ€è¦è¢«æ¸²æŸ“ï¼Œæˆ–è€…æ˜¯ä¸€äº›éœ€è¦è¢«é¢‘ç¹åˆ‡æ¢æ˜¾ç¤ºã€éšè—çŠ¶æ€çš„å…ƒç´ ä¸Šï¼Œå…¶æ¸²æŸ“æ•ˆç‡å°†ä¼šæœ‰ä¸€ä¸ªéå¸¸å¤§çš„æå‡ã€‚

#### åˆ©ç”¨ content-visibility: auto å®ç°æ‡’åŠ è½½æˆ–è™šæ‹Ÿåˆ—è¡¨

OKï¼Œæ¥ä¸‹æ¥æ˜¯ content-visibility çš„æ ¸å¿ƒç”¨æ³•ï¼Œåˆ©ç”¨ auto å±æ€§å€¼ã€‚

content-visibility: auto çš„ä½œç”¨æ˜¯ï¼Œå¦‚æœè¯¥å…ƒç´ ä¸åœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”ä¸ç”¨æˆ·æ— å…³ï¼Œåˆ™ä¸ä¼šæ¸²æŸ“å…¶åä»£å…ƒç´ ã€‚æ˜¯ä¸æ˜¯ä¸ LazyLoad éå¸¸ç±»ä¼¼ï¼Ÿ

æˆ‘ä»¬æ¥çœ‹è¿™æ ·ä¸€ä¸ª DEMO ï¼Œäº†è§£å…¶ä½œç”¨ï¼š

å‡è®¾ï¼Œæˆ‘ä»¬å­˜åœ¨è¿™æ ·ä¸€ä¸ª HTML ç»“æ„ï¼Œå«æœ‰å¤§é‡çš„æ–‡æœ¬å†…å®¹ï¼š

```html
<div class="g-wrap">
  <div class="paragraph">...</div>
  // ... åŒ…å«äº† N ä¸ª paragraph
  <div class="paragraph">...</div>
</div>
```

æ¯ä¸ª .paragraph çš„å†…å®¹å¦‚ä¸‹ï¼š

![](https://pic3.zhimg.com/80/v2-64e0e01dfbcf91fcc85db1813853cdba_720w.webp)

å› æ­¤ï¼Œæ•´ä¸ªçš„é¡µé¢çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·çš„ï¼š

![](https://s9.51cto.com/oss/202206/06/b7018be37b0837cd641801da6174995d6657a7.gif)

ç”±äºï¼Œæˆ‘ä»¬æ²¡æœ‰å¯¹é¡µé¢å†…å®¹è¿›è¡Œä»»ä½•å¤„ç†ï¼Œå› æ­¤ï¼Œæ‰€æœ‰çš„ .paragraph åœ¨é¡µé¢åˆ·æ–°çš„ä¸€ç¬é—´ï¼Œéƒ½ä¼šè¿›è¡Œæ¸²æŸ“ï¼Œçœ‹åˆ°çš„æ•ˆæœå°±å¦‚ä¸Šæ‰€ç¤ºã€‚

å½“ç„¶ï¼Œç°ä»£æµè§ˆå™¨æ„ˆåŠ è¶‹äºæ™ºèƒ½ï¼ŒåŸºäºè¿™ç§åœºæ™¯ï¼Œå…¶å®æˆ‘ä»¬éå¸¸å¸Œæœ›å¯¹äºä»æœªçœ‹åˆ°ï¼Œä»æ—§æœªæ»šåŠ¨åˆ°çš„åŒºåŸŸï¼Œå¯ä»¥å»¶è¿ŸåŠ è½½ï¼Œåªæœ‰åˆ°æˆ‘ä»¬éœ€è¦å±•ç¤ºã€æ»šåŠ¨åˆ°è¯¥å¤„æ—¶ï¼Œé¡µé¢å†…å®¹æ‰è¿›è¡Œæ¸²æŸ“ã€‚

åŸºäºè¿™ç§åœºæ™¯ï¼Œcontent-visibility: auto å°±åº”è¿è€Œç”Ÿäº†ï¼Œå®ƒå…è®¸æµè§ˆå™¨å¯¹äºè®¾ç½®äº†è¯¥å±æ€§çš„å…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¯¥å…ƒç´ å½“å‰ä¸å¤„äºè§†å£å†…ï¼Œåˆ™ä¸æ¸²æŸ“è¯¥å…ƒç´ ã€‚

æˆ‘ä»¬åŸºäºä¸Šè¿°çš„ä»£ç ï¼Œåªéœ€è¦æœ€å°åŒ–ï¼Œæ·»åŠ è¿™æ ·ä¸€æ®µä»£ç ï¼š

```less
.paragraph {
  content-visibility: auto;
}
```

å†çœ‹çœ‹æ•ˆæœï¼Œä»”ç»†è§‚å¯Ÿå³ä¾§çš„æ»šåŠ¨æ¡ï¼š

![](https://pic3.zhimg.com/80/v2-1b794a57136ed689cdc720c212528fd2_720w.webp)

> è¿™é‡Œæˆ‘ä½¿ç”¨äº† ::-webkit-scrollbar ç›¸å…³æ ·å¼ï¼Œè®©æ»šåŠ¨æ¡æ›´æ˜æ˜¾ã€‚

å¯èƒ½ä½ è¿˜æ²¡æ„è¯†åˆ°å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯¹æ¯”ä¸‹æ·»åŠ äº† content-visibility: auto å’Œæ²¡æœ‰æ·»åŠ  content-visibility: auto çš„ä¸¤ç§æ•ˆæœä¸‹æ–‡æœ¬çš„æ•´ä½“é«˜åº¦ï¼š

![](https://pic4.zhimg.com/80/v2-602a3071e40209e53d90d2215886919f_720w.webp)

æœ‰ç€éå¸¸æ˜æ˜¾çš„å·®å¼‚ï¼Œè¿™æ˜¯å› ä¸ºï¼Œè®¾ç½®äº† content-visibility: auto çš„å…ƒç´ ï¼Œåœ¨éå¯è§†åŒºåŸŸå†…ï¼Œç›®å‰å¹¶æ²¡æœ‰è¢«æ¸²æŸ“ï¼Œå› æ­¤ï¼Œå³ä¾§å†…å®¹çš„é«˜åº¦å…¶å®æ˜¯æ¯”æ­£å¸¸çŠ¶æ€ä¸‹å°‘äº†ä¸€å¤§æˆªçš„ã€‚

å¥½ï¼Œæˆ‘ä»¬å®é™…å¼€å§‹è¿›è¡Œæ»šåŠ¨ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e102aa397bf43ba95ef84642f15426b~tplv-k3u1fbpfcp-watermark.image?)

ç”±äºä¸‹æ–¹çš„å…ƒç´ åœ¨æ»šåŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°åœ¨è§†å£èŒƒå›´å†…æ‰è¢«æ¸²æŸ“ï¼Œå› æ­¤ï¼Œæ»šåŠ¨æ¡å‡ºç°äº†æ˜æ˜¾çš„é£˜å¿½ä¸å®šçš„æŠ–åŠ¨ç°è±¡ã€‚ï¼ˆå½“ç„¶è¿™ä¹Ÿæ˜¯ä½¿ç”¨äº† content-visibility: auto çš„ä¸€ä¸ªå°é—®é¢˜ä¹‹ä¸€ï¼‰ï¼Œä¸è¿‡æ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ JavaScript å®ç°çš„æ‡’åŠ è½½æˆ–è€…å»¶è¿ŸåŠ è½½éå¸¸ç±»ä¼¼ã€‚

å½“ç„¶ï¼Œä¸æ‡’åŠ è½½ä¸åŒçš„æ˜¯ï¼Œåœ¨å‘ä¸‹æ»šåŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¸Šæ–¹æ¶ˆå¤±çš„å·²ç»è¢«æ¸²æŸ“è¿‡ä¸”æ¶ˆå¤±åœ¨è§†å£çš„å…ƒç´ ï¼Œä¹Ÿä¼šå› ä¸ºæ¶ˆå¤±åœ¨è§†å£ä¸­ï¼Œé‡æ–°è¢«éšè—ã€‚å› æ­¤ï¼Œå³ä¾¿é¡µé¢æ»šåŠ¨åˆ°æœ€ä¸‹æ–¹ï¼Œæ•´ä½“çš„æ»šåŠ¨æ¡é«˜åº¦è¿˜æ˜¯æ²¡æœ‰ä»€ä¹ˆå˜åŒ–çš„ã€‚

#### content-visibility æ˜¯å¦èƒ½å¤Ÿä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ï¼Ÿ

é‚£ä¹ˆï¼Œcontent-visibility æ˜¯å¦èƒ½å¤Ÿä¼˜åŒ–æ¸²æŸ“æ€§èƒ½å‘¢ï¼Ÿ

åœ¨ Youtube -- Slashing layout cost with content-visibility[1] ä¸­ï¼Œç»™äº†ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­ã€‚

è¿™é‡Œæˆ‘ç®€å•å¤ç°ä¸€ä¸‹ã€‚

å¯¹äºä¸€ä¸ªå­˜åœ¨å·¨é‡ HTML å†…å®¹çš„é¡µé¢ï¼Œè­¬å¦‚ç±»ä¼¼äºè¿™ä¸ªé¡µé¢ -- HTML - Living Standard

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cabf96b6c33422ca4cbabfd5ca6c1f1~tplv-k3u1fbpfcp-zoom-1.image)

å¯ä»¥æ„Ÿå—åˆ°ï¼Œå¾€ä¸‹ç¿»ï¼Œæ ¹æœ¬ç¿»ä¸åˆ°å°½å¤´ã€‚ï¼ˆè¿™é‡Œæˆ‘åœ¨æœ¬åœ°æ¨¡æ‹Ÿäº†è¯¥é¡µé¢ï¼Œå¤åˆ¶äº†è¯¥é¡µé¢çš„æ‰€æœ‰ DOMï¼Œå¹¶éå®é™…åœ¨è¯¥ç½‘ç«™è¿›è¡Œæµ‹è¯•ï¼‰

å¦‚æœä¸å¯¹è¿™ä¸ªé¡µé¢åšä»»ä½•å¤„ç†ï¼Œçœ‹çœ‹é¦–æ¬¡æ¸²æŸ“éœ€è¦èŠ±è´¹çš„æ—¶é—´ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/835430f5eac64fbdb23ab575e490dd09~tplv-k3u1fbpfcp-zoom-1.image)

å¯ä»¥çœ‹åˆ°ï¼ŒDOMContentLoaded çš„æ—¶é—´çš„ 3s+ï¼Œè€ŒèŠ±è´¹åœ¨ Rendering ä¸Šçš„å°±æœ‰æ•´æ•´ 2900msï¼

è€Œå¦‚æœç»™è¿™ä¸ªé¡µé¢çš„æ¯ä¸ªæ®µè½ï¼Œæ·»åŠ ä¸Š content-visibility: autoï¼Œå†çœ‹çœ‹æ•´ä½“çš„è€—æ—¶ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42a97d40cb5f47f2a72fa575f9e205aa~tplv-k3u1fbpfcp-zoom-1.image)

å¯ä»¥çœ‹åˆ°ï¼ŒDOMContentLoaded çš„æ—¶é—´éª¤é™è‡³äº† 500ms+ï¼Œè€ŒèŠ±è´¹åœ¨ Rendering ä¸Šçš„ï¼Œç›´æ¥ä¼˜åŒ–åˆ°äº† 61msï¼

2900ms --> 61msï¼Œå¯è°“æ˜¯æƒŠäººçº§åˆ«çš„ä¼˜åŒ–äº†ã€‚å› æ­¤ï¼Œcontent-visibility: auto å¯¹äºé•¿æ–‡æœ¬ã€é•¿åˆ—è¡¨åŠŸèƒ½çš„ä¼˜åŒ–æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚

#### åˆ©ç”¨ contain-intrinsic-size è§£å†³æ»šåŠ¨æ¡æŠ–åŠ¨é—®é¢˜

å½“ç„¶ï¼Œcontent-visibility ä¹Ÿå­˜åœ¨ä¸€äº›å°é—®é¢˜ã€‚

ä»ä¸Šé¢çš„ä¾‹å­ï¼Œä¹Ÿèƒ½çœ‹åˆ°ï¼Œåœ¨åˆ©ç”¨ content-visibility: auto å¤„ç†é•¿æ–‡æœ¬ã€é•¿åˆ—è¡¨çš„æ—¶å€™ã€‚åœ¨æ»šåŠ¨é¡µé¢çš„è¿‡ç¨‹ä¸­ï¼Œæ»šåŠ¨æ¡ä¸€ç›´åœ¨æŠ–åŠ¨ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä½“éªŒã€‚

å½“ç„¶ï¼Œè¿™ä¹Ÿæ˜¯è®¸å¤šè™šæ‹Ÿåˆ—è¡¨éƒ½ä¼šå­˜åœ¨çš„ä¸€äº›é—®é¢˜ã€‚

å¥½åœ¨ï¼Œè§„èŒƒåˆ¶å®šè€…ä¹Ÿå‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ä¸ª CSS å±æ€§ï¼Œä¹Ÿå°±æ˜¯æ–‡ç« ä¸€å¼€å¤´æåˆ°çš„å¦å¤–ä¸€ä¸ªå±æ€§ -- contain-intrinsic-sizeï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

contain-intrinsic-sizeï¼šæ§åˆ¶ç”± content-visibility æŒ‡å®šçš„å…ƒç´ çš„è‡ªç„¶å¤§å°ã€‚

ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­

```html
<div class="g-wrap">
  <div class="paragraph">...</div>
  // ... åŒ…å«äº† N ä¸ª paragraph
  <div class="paragraph">...</div>
</div>
```

å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ contain-intrinsic-sizeï¼Œåªå¯¹è§†å£ä¹‹å¤–çš„å…ƒç´ ä½¿ç”¨ content-visibility: autoï¼Œé‚£ä¹ˆè§†å£å¤–çš„å…ƒç´ é«˜åº¦é€šå¸¸å°±ä¸º 0ã€‚

> å½“ç„¶ï¼Œå¦‚æœç›´æ¥ç»™çˆ¶å…ƒç´ è®¾ç½®å›ºå®šçš„ heightï¼Œä¹Ÿæ˜¯ä¼šæœ‰é«˜åº¦çš„ã€‚

é‚£ä¹ˆå®é™…çš„æ»šåŠ¨æ•ˆæœï¼Œæ»šåŠ¨æ¡å°±æ˜¯æŠ–åŠ¨çš„ï¼š

![](https://user-images.githubusercontent.com/8554143/171604657-12940ccb-f57e-4985-be49-2839e1bb3a73.gif)

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶åˆ©ç”¨ä¸Š contain-intrinsic-sizeï¼Œå¦‚æœèƒ½å‡†ç¡®çŸ¥é“è®¾ç½®äº† content-visibility: auto çš„å…ƒç´ åœ¨æ¸²æŸ“çŠ¶æ€ä¸‹çš„é«˜åº¦ï¼Œå°±å¡«å†™å¯¹åº”çš„é«˜åº¦ã€‚å¦‚æœå¦‚æ³•å‡†ç¡®çŸ¥é“é«˜åº¦ï¼Œä¹Ÿå¯ä»¥å¡«å†™ä¸€ä¸ªå¤§æ¦‚çš„å€¼ï¼š

```less
.paragraph {
  content-visibility: auto;
  contain-intrinsic-size: 320px;
}
```

å¦‚æ­¤ä¹‹åï¼Œæµè§ˆå™¨ä¼šç»™æœªè¢«å®é™…æ¸²æŸ“çš„è§†å£ä¹‹å¤–çš„ .paragraph å…ƒç´ ä¸€ä¸ªé«˜åº¦ï¼Œé¿å…å‡ºç°æ»šåŠ¨æ¡æŠ–åŠ¨çš„ç°è±¡ï¼š
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da31b0fbb9e844d099652b7389cfb773~tplv-k3u1fbpfcp-zoom-1.image)

ä½ å¯ä»¥è‡ªå·±äº²è‡ªå°è¯•æ„Ÿå—ä¸€ä¸‹ï¼š[CodePen Demo -- content-visibility: auto Demo](https://codepen.io/Chokcoco/pen/rNJvPEX)

##### content-visibility: auto VS LazyLoad

é‚£ä¹ˆï¼Œcontent-visibility: auto æ˜¯å¦å¯ä»¥æ›¿ä»£ LazyLoadï¼ˆæ‡’åŠ è½½ï¼‰å‘¢ï¼Ÿ

æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬é€šå¸¸å¯¹äº LazyLoadï¼ˆæ‡’åŠ è½½ï¼‰çš„ä¸€ä¸ªå®šä¹‰ã€‚

LazyLoadï¼šé€šå¸¸è€Œè¨€ï¼ŒLazyLoad çš„ä½œç”¨åœ¨äºï¼Œå½“é¡µé¢æœªæ»šåŠ¨åˆ°ç›¸åº”åŒºåŸŸï¼Œè¯¥åŒºåŸŸå†…çš„èµ„æºï¼ˆç½‘ç»œè¯·æ±‚ï¼‰ä¸ä¼šè¢«åŠ è½½ã€‚åä¹‹ï¼Œå½“é¡µé¢æ»šåŠ¨åˆ°ç›¸åº”åŒºåŸŸï¼Œç›¸å…³èµ„æºçš„è¯·æ±‚æ‰ä¼šè¢«å‘èµ·ã€‚

é‚£ä¹ˆï¼Œå¦‚æœ content-visibility: auto è¦èƒ½å¤Ÿæ›¿ä»£ LazyLoadï¼Œåˆ™éœ€è¦åšåˆ°ï¼Œåˆå§‹åŒ–æ¸²æŸ“çš„æ—¶å€™ï¼Œåœ¨é¡µé¢å½“å‰å±•ç¤ºèŒƒå›´å¤–çš„ï¼Œè®¾å®šäº† content-visibility: auto çš„å…ƒç´ å†…çš„ä¸€äº›é™æ€èµ„æºä¸ä¼šè¢«åŠ è½½ã€‚

è¿™é‡Œæˆ‘å°è¯•åšäº†ä¸€ä¸ªç®€å•çš„ DEMOï¼š

è¿˜æ˜¯å€ŸåŠ©ä¸Šè¿°çš„ä»£ç ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„ HTML ç»“æ„ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸Šè¿°ä»£ç åŸºç¡€ä¸Šï¼Œæ’å…¥ä¸€äº›å›¾ç‰‡èµ„æºï¼š

```html
<div class="g-wrap">
  <div class="paragraph">...</div>
  // ... åŒ…å«äº† N ä¸ª paragraph
  <div class="paragraph">...</div>
  <div class="g-img">
    <img
      src="https://www.womenly.net/wp-content/uploads/2017/03/Tips-to-Maintain-the-Soft-Skin.jpg"
    />
  </div>
  <div class="g-img">
    <img
      src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTD8kEsEE3hJ64aU-_TKQJtvKDtTOGQfT3A4A&usqp=CAU"
    />
  </div>
  <div class="g-img">
    <img src="https://i.pinimg.com/originals/e8/ba/25/e8ba252917952f23dfc9715e942e654e.jpg" />
  </div>
</div>
```

```css
.paragraph,
.g-img {
  content-visibility: auto;
}
```

å½“åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œè§‚å¯Ÿç½‘ç»œè¯·æ±‚ï¼ˆNetworkï¼‰çš„çŠ¶å†µï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad19e25632be4c54b6be7bf32fe9eafd~tplv-k3u1fbpfcp-zoom-1.image)

å³ä¾¿å½“å‰é¡µé¢å¯è§†åŒºåŸŸå¤–çš„å†…å®¹æœªè¢«æ¸²æŸ“ï¼Œä½†æ˜¯å›¾ç‰‡ä¾ç„¶ä¼šè¢«åŠ è½½ï¼

å› æ­¤ï¼Œè¿™ä¹Ÿå¾—åˆ°äº†ä¸€ä¸ªéå¸¸é‡è¦çš„ç»“è®ºï¼š

content-visibility: auto æ— æ³•ç›´æ¥æ›¿ä»£ LazyLoadï¼Œè®¾ç½®äº† content-visibility: auto çš„å…ƒç´ åœ¨å¯è§†åŒºå¤–åªæ˜¯æœªè¢«æ¸²æŸ“ï¼Œä½†æ˜¯å…¶ä¸­çš„é™æ€èµ„æºä»æ—§ä¼šåœ¨é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™è¢«å…¨éƒ¨åŠ è½½ã€‚

æ‰€ä»¥ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡ä¸­å·²ç»ä½¿ç”¨äº†æ¯”è¾ƒå®Œå–„çš„ Lazyload å¤„ç†é•¿åˆ—è¡¨æˆ–è€…ä¸€äº›å›¾ç‰‡èµ„æºï¼Œé‚£ä¹ˆ content-visibility: auto ä¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

##### å¯è®¿é—®æ€§åŠŸèƒ½æ¢ç©¶

å½“ç„¶ï¼Œcontent-visibility: auto çš„ç‰¹æ€§åˆå¼•ç”³å‡ºäº†å¦å¤–ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹ã€‚

å¦‚æœè¯´å¯è§†åŒºå¤–çš„å†…å®¹æœªè¢«æ¸²æŸ“ï¼Œé‚£æ˜¯å¦ä¼šå½±å“ç”¨æˆ·è¿›è¡Œå…¨æ–‡æ£€ç´¢å‘¢ï¼Ÿæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ã€‚

æˆ‘ä»¬å†æ¥åšä¸ªæ¢ç©¶ï¼Œè¿˜æ˜¯ä¸Šé¢çš„ DEMOï¼Œæˆ‘ä»¬åœ¨é¦–å°¾æ·»åŠ ä¸¤ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼š

```html
<div class="g-wrap">
  <div class="text">
    <p>content-visibility: auto å¯¹æœç´¢åŠŸèƒ½å½±å“çš„æ¢ç©¶</p>
  </div>
  <div class="paragraph">...</div>
  // ... åŒ…å«äº† N ä¸ª paragraph
  <div class="paragraph">...</div>
  <div class="text">
    <p>content-visibility: auto å¯¹æœç´¢åŠŸèƒ½å½±å“çš„æ¢ç©¶</p>
  </div>
</div>
```

```css
.paragraph,
.text {
  content-visibility: auto;
}
```

å¥½ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œåœ¨é¡µé¢åˆ·æ–°åï¼Œç¬¬äºŒä¸ª .text æ˜¯å¤„äºæœªè¢«æ¸²æŸ“çŠ¶æ€ï¼Œæˆ‘ä»¬è¯•ç€å…¨å±€ ctrl + F æŸ¥æ‰¾ä¸€ä¸‹ï¼Œçœ‹çœ‹èƒ½æ‰¾åˆ°å‡ ä¸ªï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5781f6ac0544eddae4be5599a4a6ee8~tplv-k3u1fbpfcp-zoom-1.image)

å¾ˆæœ‰æ„æ€çš„ç°è±¡ï¼Œå…¨å±€æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¯ä»¥æ‰¾åˆ°å½“å‰æœªè¢«æ¸²æŸ“çš„å…ƒç´ å†…çš„å†…å®¹ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦å¤–ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ï¼š

å³ä¾¿å­˜åœ¨è®¾ç½®äº† content-visibility: auto çš„æœªè¢«æ¸²æŸ“çš„å…ƒç´ ï¼Œä½†æ˜¯å®ƒå¹¶ä¸ä¼šå½±å“å…¨å±€çš„æœç´¢åŠŸèƒ½ã€‚

è¿™ä¹Ÿæ˜¯ content-visibility è®¾è®¡ä¸Šå……åˆ†çš„è€ƒè™‘ï¼Œå¯¹å¯è®¿é—®æ€§åŠŸèƒ½ï¼Œæˆ–è€…è¯´ç”¨æˆ·ä½“éªŒçš„è€ƒé‡ï¼Œæœ‰äº†è¿™ä¸€ç‚¹ï¼Œå¯¹äºå®ƒçš„å®é™…ä½¿ç”¨æœ‰ç€éå¸¸å¤§çš„å¸®åŠ©ã€‚

##### content-visibility çš„ä¸€äº›å…¶ä»–é—®é¢˜

é¦–å…ˆï¼Œçœ‹çœ‹ content-visibility çš„å…¼å®¹æ€§ï¼ˆ2022-06-03ï¼‰ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3bdfd828cb97449385dfaf5aa205c894~tplv-k3u1fbpfcp-zoom-1.image)

ç›®å‰è¿˜æ˜¯æ¯”è¾ƒæƒ¨æ·¡çš„ï¼Œå¹¶ä¸”æˆ‘æ²¡æœ‰å®é™…åœ¨ä¸šåŠ¡ä¸­ä½¿ç”¨å®ƒï¼Œéœ€è¦å†ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚å½“ç„¶ï¼Œç”±äºè¯¥å±æ€§å±äºæ¸è¿›å¢å¼ºä¸€ç±»çš„åŠŸèƒ½ï¼Œå³ä¾¿å¤±æ•ˆï¼Œä¹Ÿå®Œå…¨ä¸å½±å“é¡µé¢æœ¬èº«çš„å±•ç¤ºã€‚

åŒæ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›åŒå­¦è¡¨ç¤ºï¼Œåˆ©ç”¨ content-visibility: auto åªèƒ½è§£å†³éƒ¨åˆ†åœºæ™¯ï¼Œåœ¨æµ·é‡ DOM çš„åœºæ™¯ä¸‹çš„å®é™…æ•ˆæœï¼Œè¿˜æœ‰å¾…è¿›ä¸€æ­¥çš„å®æµ‹ã€‚çœŸæ­£è¿ç”¨çš„æ—¶å€™ï¼Œå¤šåšå¯¹æ¯”ï¼Œå†åšå–èˆã€‚

å½“ç„¶ï¼Œç°ä»£æµè§ˆå™¨å·²ç»è¶Šæ¥è¶Šæ™ºèƒ½ï¼Œç±»ä¼¼ content-visibility åŠŸèƒ½çš„å±æ€§ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä»¬åœ¨æ€§èƒ½ä¼˜åŒ–çš„è·¯ä¸Šæœ‰äº†æ›´å¤šé€‰æ‹©ï¼Œæ€»å½’æ˜¯ä¸€ä»¶å¥½äº‹ã€‚

æœ€å
æœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ© :)

æƒ³ Get åˆ°æœ€æœ‰æ„æ€çš„ CSS èµ„è®¯ï¼Œåƒä¸‡ä¸è¦é”™è¿‡æˆ‘çš„å…¬ä¼—å· -- iCSS å‰ç«¯è¶£é—» ğŸ˜„

æ›´å¤šç²¾å½© CSS æŠ€æœ¯æ–‡ç« æ±‡æ€»åœ¨æˆ‘çš„ [Github -- iCSS](https://github.com/chokcoco/iCSS) ï¼ŒæŒç»­æ›´æ–°ï¼Œæ¬¢è¿ç‚¹ä¸ª star è®¢é˜…æ”¶è—ã€‚

#### æ¥æº

- [ä½¿ç”¨ content-visibility ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½](https://mp.weixin.qq.com/s/o9lpl7CTwcbjM0q3QMRLTg)

### 2. æµ…æ path å¸¸ç”¨å·¥å…·å‡½æ•°æºç 

#### å‰è¨€

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šç»å¸¸ç”¨åˆ° [Node.js](https://nodejs.org/dist/latest-v16.x/docs/api) ï¼Œå®ƒåˆ©ç”¨ V8 æä¾›çš„èƒ½åŠ›ï¼Œæ‹“å±•äº† JS çš„èƒ½åŠ›ã€‚è€Œåœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JS ä¸­æœ¬æ¥ä¸å­˜åœ¨çš„ [path](https://github.com/nodejs/node/blob/v16.14.0/lib/path.js) æ¨¡å—ï¼Œä¸ºäº†æˆ‘ä»¬æ›´åŠ ç†Ÿæ‚‰çš„è¿ç”¨ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹å§~

æœ¬æ–‡ Node.js ç‰ˆæœ¬ä¸º 16.14.0ï¼Œæœ¬æ–‡çš„æºç æ¥è‡ªäºæ­¤ç‰ˆæœ¬ã€‚å¸Œæœ›å¤§å®¶é˜…è¯»æœ¬æ–‡åï¼Œä¼šå¯¹å¤§å®¶é˜…è¯»æºç æœ‰æ‰€å¸®åŠ©ã€‚

path çš„å¸¸è§ä½¿ç”¨åœºæ™¯
Path ç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„ï¼Œè¿™ä¸ªæ¨¡å—ä¸­æä¾›äº†ä¸€äº›ä¾¿äºå¼€å‘è€…å¼€å‘çš„å·¥å…·å‡½æ•°ï¼Œæ¥ååŠ©æˆ‘ä»¬è¿›è¡Œå¤æ‚çš„è·¯å¾„åˆ¤æ–­ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ä¾‹å¦‚ï¼š

1. åœ¨é¡¹ç›®ä¸­é…ç½®åˆ«åï¼Œåˆ«åçš„é…ç½®æ–¹ä¾¿æˆ‘ä»¬å¯¹æ–‡ä»¶æ›´ç®€ä¾¿çš„å¼•ç”¨ï¼Œé¿å…æ·±å±‚çº§é€çº§å‘ä¸ŠæŸ¥æ‰¾ã€‚

```js
reslove: {
  alias: {
    // __dirname å½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„
    'src': path.resolve(__dirname, './src'),
    // process.cwd å½“å‰å·¥ä½œç›®å½•
    '@': path.join(process.cwd(), 'src'),
  },
}
```

2. åœ¨ webpack ä¸­ï¼Œæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä»¬è‡ªè¡Œé…ç½®ç”Ÿæˆåˆ°æŒ‡å®šçš„ä½ç½®ã€‚

```js
module.exports = {
  entry: './path/to/my/entry/file.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'my-first-webpack.bundle.js',
  },
}
```

3. åˆæˆ–è€…å¯¹äºæ–‡ä»¶å¤¹çš„æ“ä½œ

```js
let fs = require('fs')
let path = require('path')

// åˆ é™¤æ–‡ä»¶å¤¹
let deleDir = (src) => {
  // è¯»å–æ–‡ä»¶å¤¹
  let children = fs.readdirSync(src)
  children.forEach((item) => {
    let childpath = path.join(src, item)
    // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    let file = fs.statSync(childpath).isFile()
    if (file) {
      // æ–‡ä»¶å­˜åœ¨å°±åˆ é™¤
      fs.unlinkSync(childpath)
    } else {
      // ç»§ç»­æ£€æµ‹æ–‡ä»¶å¤¹
      deleDir(childpath)
    }
  })
  // åˆ é™¤ç©ºæ–‡ä»¶å¤¹
  fs.rmdirSync(src)
}
deleDir('../floor')
```

ç®€å•çš„äº†è§£äº†ä¸€ä¸‹ path çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ ¹æ®ä½¿ç”¨æ¥ç ”ç©¶ä¸€ä¸‹å®ƒçš„æ‰§è¡Œæœºåˆ¶ï¼Œä»¥åŠæ˜¯æ€ä¹ˆå®ç°çš„ã€‚

#### path çš„æ‰§è¡Œæœºåˆ¶

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5ee5f05109940c89ec4bc021a1403e1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

1. å¼•å…¥ path æ¨¡å—ï¼Œè°ƒç”¨ path çš„å·¥å…·å‡½æ•°çš„æ—¶å€™ï¼Œä¼šè¿›å…¥åŸç”Ÿæ¨¡å—çš„å¤„ç†é€»è¾‘ã€‚
2. ä½¿ç”¨ `_load` å‡½æ•°æ ¹æ®ä½ å¼•å…¥çš„æ¨¡å—åä½œä¸º IDï¼Œåˆ¤æ–­è¦åŠ è½½çš„æ¨¡å—æ˜¯åŸç”Ÿ JS æ¨¡å—åï¼Œä¼šé€šè¿‡ loadNativeModule å‡½æ•°ï¼Œåˆ©ç”¨ id ä» `_source` (ä¿å­˜åŸç”Ÿ JS æ¨¡å—çš„æºç å­—ç¬¦ä¸²è½¬æˆçš„ ASCII ç )ä¸­æ‰¾åˆ°å¯¹åº”çš„æ•°æ®åŠ è½½åŸç”Ÿ JS æ¨¡å—ã€‚
3. æ‰§è¡Œ lib/path.js æ–‡ä»¶ï¼Œåˆ©ç”¨ process åˆ¤æ–­æ“ä½œç³»ç»Ÿï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒï¼Œåœ¨å…¶æ–‡ä»¶å¤„ç†ä¸Šå¯èƒ½ä¼šå­˜åœ¨æ“ä½œå­—ç¬¦çš„å·®å¼‚åŒ–å¤„ç†ï¼Œä½†æ–¹æ³•å¤§è‡´ä¸€æ ·ï¼Œå¤„ç†å®Œåè¿”å›ç»™è°ƒç”¨æ–¹ã€‚

#### å¸¸ç”¨å·¥å…·å‡½æ•°ç®€æ

##### resolve è¿”å›å½“å‰è·¯å¾„çš„ç»å¯¹è·¯å¾„

resolve å°†å¤šä¸ªå‚æ•°ï¼Œä¾æ¬¡è¿›è¡Œæ‹¼æ¥ï¼Œç”Ÿæˆæ–°çš„ç»å¯¹è·¯å¾„ã€‚

```js
resolve(...args) {
  let resolvedDevice = '';
  let resolvedTail = '';
  let resolvedAbsolute = false;

  // ä»å³åˆ°å·¦æ£€æµ‹å‚æ•°
  for (let i = args.length - 1; i >= -1; i--) {
    ......
  }

  // è§„èŒƒåŒ–è·¯å¾„
  resolvedTail = normalizeString(resolvedTail, !resolvedAbsolute, '\\', isPathSeparator);

  return resolvedAbsolute ?
    `${resolvedDevice}\\${resolvedTail}` :
    `${resolvedDevice}${resolvedTail}` || '.';
}
```

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/384bcc551026473f85b8e530a8568b9e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æ ¹æ®å‚æ•°è·å–è·¯å¾„ï¼Œå¯¹æ¥æ”¶åˆ°çš„å‚æ•°è¿›è¡Œéå†ï¼Œå‚æ•°çš„é•¿åº¦å¤§äºç­‰äº 0 æ—¶éƒ½ä¼šå¼€å§‹è¿›è¡Œæ‹¼æ¥ï¼Œå¯¹æ‹¼æ¥å¥½çš„ path è¿›è¡Œéå­—ç¬¦ä¸²æ ¡éªŒï¼Œæœ‰ä¸ç¬¦åˆçš„å‚æ•°åˆ™æŠ›å‡º `throw new ERR_INVALID_ARG_TYPE(name, 'string', value)`, ç¬¦åˆè¦æ±‚åˆ™ä¼šå¯¹ path è¿›è¡Œé•¿åº¦åˆ¤æ–­ï¼Œæœ‰å€¼åˆ™ +=path åšä¸‹ä¸€æ­¥æ“ä½œã€‚

```js
let path;

if (i >= 0) {
  path = args[i];
  // internal/validators
  validateString(path, 'path');
  // path é•¿åº¦ä¸º 0 çš„è¯ï¼Œä¼šç›´æ¥è·³å‡ºä¸Šè¿°ä»£ç å—çš„ for å¾ªç¯
  if (path.length === 0) {
    continue;
  }
} else if (resolvedDevice.length === 0) {
  // resolvedDevice çš„é•¿åº¦ä¸º 0ï¼Œç»™ path èµ‹å€¼ä¸ºå½“å‰å·¥ä½œç›®å½•
  path = process.cwd();
} else {
  // èµ‹å€¼ä¸ºç¯å¢ƒå¯¹è±¡æˆ–è€…å½“å‰å·¥ä½œç›®å½•
  path = process.env[`=${resolvedDevice}`] || process.cwd();
  if (path === undefined ||
      (StringPrototypeToLowerCase(StringPrototypeSlice(path, 0, 2)) !==
      StringPrototypeToLowerCase(resolvedDevice) &&
      StringPrototypeCharCodeAt(path, 2) === CHAR_BACKWARD_SLASH)) {
    // å¯¹ path è¿›è¡Œéç©ºä¸ç»å¯¹è·¯å¾„åˆ¤æ–­å¾—å‡º path è·¯å¾„
    path = `${resolvedDevice}\\`;
  }
}
```

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b21ad707a494a0e868d7561361175d3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

å°è¯•åŒ¹é…æ ¹è·¯å¾„ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åªæœ‰ä¸€ä¸ªè·¯å¾„åˆ†éš”ç¬¦ ('\') æˆ–è€… path ä¸ºç»å¯¹è·¯å¾„ï¼Œç„¶åç»™ç»å¯¹è·¯å¾„æ‰“æ ‡ï¼Œå¹¶æŠŠ rootEnd æˆªå–æ ‡è¯†è®¾ä¸º 1 (ä¸‹æ ‡)ã€‚ç¬¬äºŒé¡¹è‹¥è¿˜æ˜¯è·¯å¾„åˆ†éš”ç¬¦ ('\')ï¼Œå°±å®šä¹‰æˆªå–å€¼ä¸º 2 (ä¸‹æ ‡)ï¼Œå¹¶ç”¨ last ä¿å­˜æˆªå–å€¼ï¼Œä»¥ä¾¿åç»­åˆ¤æ–­ä½¿ç”¨ã€‚

ç»§ç»­åˆ¤æ–­ç¬¬ä¸‰é¡¹æ˜¯å¦æ˜¯è·¯å¾„åˆ†éš”ç¬¦ ('\')ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆä¸ºç»å¯¹è·¯å¾„ï¼ŒrootEnd æˆªå–æ ‡è¯†ä¸º 1 (ä¸‹æ ‡)ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æ˜¯ [UNC](https://baike.baidu.com/item/UNC%E8%B7%AF%E5%BE%84/3231808) è·¯å¾„(\servername\sharenameï¼Œservername æœåŠ¡å™¨åã€‚sharename å…±äº«èµ„æºåç§°)ã€‚å¦‚æœæœ‰å…¶ä»–å€¼ï¼Œæˆªå–å€¼ä¼šç»§ç»­è¿›è¡Œè‡ªå¢è¯»å–åé¢çš„å€¼ï¼Œå¹¶ç”¨ firstPart ä¿å­˜ç¬¬ä¸‰ä½çš„å€¼ï¼Œä»¥ä¾¿æ‹¼æ¥ç›®å½•æ—¶å–å€¼ï¼Œå¹¶æŠŠ last å’Œæˆªå–å€¼ä¿æŒä¸€è‡´ï¼Œä»¥ä¾¿ç»“æŸåˆ¤æ–­ã€‚

```js
const len = path.length
let rootEnd = 0 // è·¯å¾„æˆªå–ç»“æŸä¸‹æ ‡
let device = '' // ç£ç›˜æ ¹ D:\ã€C:\
let isAbsolute = false // æ˜¯å¦æ˜¯ç£ç›˜æ ¹è·¯å¾„
const code = StringPrototypeCharCodeAt(path, 0)

// path é•¿åº¦ä¸º 1
if (len === 1) {
  // åªæœ‰ä¸€ä¸ªè·¯å¾„åˆ†éš”ç¬¦\ä¸ºç»å¯¹è·¯å¾„
  if (isPathSeparator(code)) {
    rootEnd = 1
    isAbsolute = true
  }
} else if (isPathSeparator(code)) {
  // å¯èƒ½æ˜¯ UNC æ ¹ï¼Œä»ä¸€ä¸ªåˆ†éš”ç¬¦ \ å¼€å§‹ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®ƒå°±æ˜¯æŸç§ç»å¯¹è·¯å¾„ï¼ˆUNC æˆ–å…¶ä»–ï¼‰
  isAbsolute = true
  // å¼€å§‹åŒ¹é…åŒè·¯å¾„åˆ†éš”ç¬¦
  if (isPathSeparator(StringPrototypeCharCodeAt(path, 1))) {
    let j = 2
    let last = j
    // åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéè·¯å¾„åˆ†éš”ç¬¦
    while (j < len && !isPathSeparator(StringPrototypeCharCodeAt(path, j))) {
      j++
    }
    if (j < len && j !== last) {
      const firstPart = StringPrototypeSlice(path, last, j)
      last = j
      // åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè·¯å¾„åˆ†éš”ç¬¦
      while (j < len && isPathSeparator(StringPrototypeCharCodeAt(path, j))) {
        j++
      }
      if (j < len && j !== last) {
        last = j
        while (j < len && !isPathSeparator(StringPrototypeCharCodeAt(path, j))) {
          j++
        }
        if (j === len || j !== last) {
          device = `\\\\${firstPart}\\${StringPrototypeSlice(path, last, j)}`
          rootEnd = j
        }
      }
    }
  } else {
    rootEnd = 1
  }
  // æ£€æµ‹ç£ç›˜æ ¹ç›®å½•åŒ¹é… ä¾‹ï¼šD:ï¼ŒC:\
} else if (isWindowsDeviceRoot(code) && StringPrototypeCharCodeAt(path, 1) === CHAR_COLON) {
  device = StringPrototypeSlice(path, 0, 2)
  rootEnd = 2
  if (len > 2 && isPathSeparator(StringPrototypeCharCodeAt(path, 2))) {
    isAbsolute = true
    rootEnd = 3
  }
}
```

æ£€æµ‹è·¯å¾„å¹¶ç”Ÿæˆï¼Œæ£€æµ‹ç£ç›˜æ ¹ç›®å½•æ˜¯å¦å­˜åœ¨æˆ–è§£æ resolvedAbsolute æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ã€‚

```js
// æ£€æµ‹ç£ç›˜æ ¹ç›®å½•
if (device.length > 0) {
  // resolvedDevice æœ‰å€¼
  if (resolvedDevice.length > 0) {
    if (StringPrototypeToLowerCase(device) !==
        StringPrototypeToLowerCase(resolvedDevice))
      continue;
  } else {
    // resolvedDevice æ— å€¼å¹¶èµ‹å€¼ä¸ºç£ç›˜æ ¹ç›®å½•
    resolvedDevice = device;
  }
}

// ç»å¯¹è·¯å¾„
if (resolvedAbsolute) {
  // ç£ç›˜æ ¹ç›®å½•å­˜åœ¨ç»“æŸå¾ªç¯
  if (resolvedDevice.length > 0)
    break;
} else {
  // è·å–è·¯å¾„å‰ç¼€è¿›è¡Œæ‹¼æ¥
  resolvedTail =
    `${StringPrototypeSlice(path, rootEnd)}\\${resolvedTail}`;
  resolvedAbsolute = isAbsolute;
  if (isAbsolute && resolvedDevice.length > 0) {
    // ç£ç›˜æ ¹å­˜åœ¨ä¾¿ç»“æŸå¾ªç¯
    break;
  }
}
```

join æ ¹æ®ä¼ å…¥çš„ path ç‰‡æ®µè¿›è¡Œè·¯å¾„æ‹¼æ¥

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b21ad707a494a0e868d7561361175d3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

1. æ¥æ”¶å¤šä¸ªå‚æ•°,åˆ©ç”¨ç‰¹å®šåˆ†éš”ç¬¦ä½œä¸ºå®šç•Œç¬¦å°†æ‰€æœ‰çš„ path å‚æ•°è¿æ¥åœ¨ä¸€èµ·,ç”Ÿæˆæ–°çš„è§„èŒƒåŒ–è·¯å¾„ã€‚
2. æ¥æ”¶å‚æ•°åè¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰å‚æ•°çš„è¯ï¼Œä¼šç›´æ¥è¿”å› '.'ï¼Œåä¹‹è¿›è¡Œéå†ï¼Œé€šè¿‡å†…ç½® validateString æ–¹æ³•æ ¡éªŒæ¯ä¸ªå‚æ•°ï¼Œå¦‚æœ‰ä¸€é¡¹ä¸åˆè§„åˆ™ç›´æ¥ throw new ERR_INVALID_ARG_TYPE(name, 'string', value)ï¼›
3. window ä¸‹ä¸ºåæ–œæ  ('\'), è€Œ linux ä¸‹ä¸ºæ­£æ–œæ  ('/')ï¼Œè¿™é‡Œæ˜¯ join æ–¹æ³•åŒºåˆ†æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªä¸åŒç‚¹ï¼Œè€Œåæ–œæ  () æœ‰è½¬ä¹‰ç¬¦çš„ä½œç”¨ï¼Œå•ç‹¬ä½¿ç”¨ä¼šè¢«è®¤ä¸ºæ˜¯è¦è½¬ä¹‰æ–œæ åé¢çš„å­—ç¬¦ä¸²ï¼Œæ•…æ­¤ä½¿ç”¨åŒåæ–œæ è½¬ä¹‰å‡ºåæ–œæ  ('\') ä½¿ç”¨ã€‚
4. æœ€åè¿›è¡Œæ‹¼æ¥åçš„å­—ç¬¦ä¸²æ ¡éªŒå¹¶æ ¼å¼åŒ–è¿”å›ã€‚

```js
if (args.length === 0) return '.'

let joined
let firstPart
// ä»å·¦åˆ°å³æ£€æµ‹å‚æ•°
for (let i = 0; i < args.length; ++i) {
  const arg = args[i]
  // internal/validators
  validateString(arg, 'path')
  if (arg.length > 0) {
    if (joined === undefined)
      // æŠŠç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ç»™ joinedï¼Œå¹¶ç”¨ firstPart å˜é‡ä¿å­˜ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä»¥å¾…åé¢ä½¿ç”¨
      joined = firstPart = arg
    // joined æœ‰å€¼ï¼Œè¿›è¡Œ += æ‹¼æ¥æ“ä½œ
    else joined += `\\${arg}`
  }
}

if (joined === undefined) return '.'
```

åœ¨ window ç³»ç»Ÿä¸‹ï¼Œå› ä¸ºä½¿ç”¨åæ–œæ  ('\') å’Œ UNC (ä¸»è¦æŒ‡å±€åŸŸç½‘ä¸Šèµ„æºçš„å®Œæ•´ Windows 2000 åç§°) è·¯å¾„çš„ç¼˜æ•…ï¼Œéœ€è¦è¿›è¡Œç½‘ç»œè·¯å¾„å¤„ç†ï¼Œ('\\') ä»£è¡¨çš„æ˜¯ç½‘ç»œè·¯å¾„æ ¼å¼ï¼Œå› æ­¤åœ¨ win32 ä¸‹æŒ‚è½½çš„ join æ–¹æ³•é»˜è®¤ä¼šè¿›è¡Œæˆªå–æ“ä½œã€‚

å¦‚æœåŒ¹é…å¾—åˆ°åæ–œæ  ('\')ï¼ŒslashCount å°±ä¼šè¿›è¡Œè‡ªå¢æ“ä½œï¼Œåªè¦åŒ¹é…åæ–œæ  ('\') å¤§äºä¸¤ä¸ªå°±ä¼šå¯¹æ‹¼æ¥å¥½çš„è·¯å¾„è¿›è¡Œæˆªå–æ“ä½œï¼Œå¹¶æ‰‹åŠ¨æ‹¼æ¥è½¬ä¹‰åçš„åæ–œæ  ('\')ã€‚

```js
let needsReplace = true
let slashCount = 0
// æ ¹æ® StringPrototypeCharCodeAt å¯¹é¦–ä¸ªå­—ç¬¦ä¸²ä¾æ¬¡è¿›è¡Œ code ç æå–ï¼Œå¹¶é€šè¿‡ isPathSeparator æ–¹æ³•ä¸å®šä¹‰å¥½çš„ code ç è¿›è¡ŒåŒ¹é…
if (isPathSeparator(StringPrototypeCharCodeAt(firstPart, 0))) {
  ++slashCount
  const firstLen = firstPart.length
  if (firstLen > 1 && isPathSeparator(StringPrototypeCharCodeAt(firstPart, 1))) {
    ++slashCount
    if (firstLen > 2) {
      if (isPathSeparator(StringPrototypeCharCodeAt(firstPart, 2))) ++slashCount
      else {
        needsReplace = false
      }
    }
  }
}

if (needsReplace) {
  while (
    slashCount < joined.length &&
    isPathSeparator(StringPrototypeCharCodeAt(joined, slashCount))
  ) {
    slashCount++
  }

  if (slashCount >= 2) joined = `\\${StringPrototypeSlice(joined, slashCount)}`
}
```

##### æ‰§è¡Œç»“æœæ¢³ç†

|                    | resolve                                                                                                     | join                                                                                              |
| ------------------ | ----------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| æ— å‚æ•°             | å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„                                                                                          | .                                                                                                 |
| å‚æ•°æ— ç»å¯¹è·¯å¾„     | å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æŒ‰é¡ºåºæ‹¼æ¥å‚æ•°                                                                            | æ‹¼æ¥æˆçš„è·¯å¾„                                                                                      |
| é¦–ä¸ªå‚æ•°ä¸ºç»å¯¹è·¯å¾„ | å‚æ•°è·¯å¾„è¦†ç›–å½“å‰æ–‡ä»¶ç»å¯¹è·¯å¾„å¹¶æ‹¼æ¥åç»­éç»å¯¹è·¯å¾„                                                            | æ‹¼æ¥æˆçš„ç»å¯¹è·¯å¾„                                                                                  |
| ç½®å‚æ•°ä¸ºç»å¯¹è·¯å¾„   | å‚æ•°è·¯å¾„è¦†ç›–å½“å‰æ–‡ä»¶ç»å¯¹è·¯å¾„å¹¶è¦†ç›–å‰ç½®å‚æ•°                                                                  | æ‹¼æ¥æˆçš„è·¯å¾„                                                                                      |
| é¦–ä¸ªå‚æ•°ä¸º (./)    | æœ‰åç»­å‚æ•°ï¼Œå½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æ‹¼æ¥å‚æ•° æ— åç»­å‚æ•°ï¼Œå½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„                                       | æœ‰åç»­å‚æ•°ï¼Œåç»­å‚æ•°æ‹¼æ¥æˆçš„è·¯å¾„ æ— åç»­å‚æ•°ï¼Œ(./)                                                 |
| åç½®å‚æ•°æœ‰ (./)    | è§£æåçš„ç»å¯¹è·¯å¾„æ‹¼æ¥å‚æ•°                                                                                    | æœ‰åç»­å‚æ•°ï¼Œæ‹¼æ¥æˆçš„è·¯å¾„æ‹¼æ¥åç»­å‚æ•° æ— åç»­å‚æ•°ï¼Œæ‹¼æ¥ (/)                                         |
| é¦–ä¸ªå‚æ•°ä¸º(../)    | æœ‰åç»­å‚æ•°ï¼Œè¦†ç›–å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„çš„æœ€åä¸€çº§ç›®å½•åæ‹¼æ¥å‚æ•° æ— åç»­å‚æ•°ï¼Œè¦†ç›–å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„çš„æœ€åä¸€çº§ç›®å½• | æœ‰åç»­å‚æ•°ï¼Œæ‹¼æ¥åç»­å‚æ•° æ— åç»­å‚æ•°ï¼Œ(../)                                                        |
| åç½®å‚æ•°æœ‰(../)    | å‡ºç° (../) çš„ä¸Šå±‚ç›®å½•ä¼šè¢«è¦†ç›–ï¼Œåç½®å‡ºç°å¤šå°‘ä¸ªï¼Œå°±ä¼šè¦†ç›–å¤šå°‘å±‚ï¼Œä¸Šå±‚ç›®å½•è¢«è¦†ç›–å®Œåï¼Œè¿”å› (/)ï¼Œåç»­å‚æ•°ä¼šæ‹¼æ¥ | å‡ºç° (../) çš„ä¸Šå±‚ç›®å½•ä¼šè¢«è¦†ç›–ï¼Œåç½®å‡ºç°å¤šå°‘ä¸ªï¼Œå°±ä¼šè¦†ç›–å¤šå°‘å±‚ï¼Œä¸Šå±‚ç›®å½•è¢«è¦†ç›–å®Œåï¼Œä¼šè¿›è¡Œå‚æ•°æ‹¼æ¥ |

#### æ€»ç»“

é˜…è¯»äº†æºç ä¹‹åï¼Œresolve æ–¹æ³•ä¼šå¯¹å‚æ•°è¿›è¡Œå¤„ç†ï¼Œè€ƒè™‘è·¯å¾„çš„å½¢å¼ï¼Œåœ¨æœ€åæŠ›å‡ºç»å¯¹è·¯å¾„ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯è¿›è¡Œæ–‡ä»¶ä¹‹ç±»çš„æ“ä½œï¼Œæ¨èä½¿ç”¨ resolve æ–¹æ³•ï¼Œç›¸æ¯”æ¥çœ‹ï¼Œ resolve æ–¹æ³•å°±ç®—æ²¡æœ‰å‚æ•°ä¹Ÿä¼šè¿”å›ä¸€ä¸ªè·¯å¾„ï¼Œä¾›ä½¿ç”¨è€…æ“ä½œï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šè¿›è¡Œè·¯å¾„çš„å¤„ç†ã€‚è€Œ join æ–¹æ³•åªæ˜¯å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œè§„èŒƒåŒ–æ‹¼æ¥ï¼Œå¯¹äºç”Ÿæˆä¸€ä¸ªæ–°çš„è·¯å¾„æ¯”è¾ƒå®ç”¨ï¼Œå¯ä»¥æŒ‰ç…§ä½¿ç”¨è€…æ„æ„¿åˆ›å»ºã€‚ä¸è¿‡æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¼˜ç‚¹ï¼Œè¦æ ¹æ®è‡ªå·±çš„ä½¿ç”¨åœºæ™¯ä»¥åŠé¡¹ç›®éœ€æ±‚ï¼Œå»é€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚

#### æ¥æº

- [æµ…æ path å¸¸ç”¨å·¥å…·å‡½æ•°æºç ](https://mp.weixin.qq.com/s/mbQC-NVlHg-7QW1c8T8xbA)

## ts æŒ‘æˆ˜

### Fill

```ts
type exp = Fill<[1, 2, 3], 0> // expected to be [0, 0, 0]
type ChangeToArr<T extends number, Res extends any[] = []> = Res['length'] extends T
  ? Res
  : ChangeToArr<T, [...Res, 1]>

type IsBigThan<
  Start extends number,
  End extends number,
  StartArr extends any[] = ChangeToArr<Start>,
  EndArr extends any[] = ChangeToArr<End>
> = StartArr extends [infer AStart, ...infer BStart]
  ? EndArr extends [infer AEnd, ...infer BEnd]
    ? BEnd extends []
      ? BStart extends []
        ? true
        : true
      : IsBigThan<Start, End, BStart, BEnd>
    : true
  : End extends 0
  ? true
  : false

type IsSmallThan<
  Start extends number,
  End extends number,
  StartArr extends any[] = ChangeToArr<Start>,
  EndArr extends any[] = ChangeToArr<End>
> = StartArr extends [infer AStart, ...infer BStart]
  ? EndArr extends [infer AEnd, ...infer BEnd]
    ? BStart extends []
      ? BEnd extends []
        ? false
        : true
      : IsSmallThan<Start, End, BStart, BEnd>
    : false
  : End extends 0
  ? false
  : true

type Fill<
  T extends unknown[],
  N,
  Start extends number = 0,
  End extends number = T['length'],
  Res extends any[] = []
> = IsBigThan<Res['length'], Start> extends true
  ? IsSmallThan<Res['length'], End> extends true
    ? T extends [infer A, ...infer B]
      ? Fill<B, N, Start, End, [...Res, N]>
      : Res
    : T extends [infer A, ...infer B]
    ? Fill<B, N, Start, End, [...Res, A]>
    : Res
  : T extends [infer A, ...infer B]
  ? Fill<B, N, Start, End, [...Res, A]>
  : Res
```

- [è¯¦è§](https://github.com/type-challenges/type-challenges/issues/7964)

### ä¸ŠæœŸç­”æ¡ˆ

#### RequiredByKeys

```ts
interface User {
  name?: string
  age?: number
  address?: string
}

type UserRequiredName = RequiredByKeys<User, 'name'> // { name: string; age?: number; address?: string }
```
